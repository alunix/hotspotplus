var _0x0a53=['YXNzaWduRnJlZVBsYW5Ub01lbWJlcg==','Z2V0UHVibGljSW50ZXJuZXRQbGFucw==','QGdldFB1YmxpY0ludGVybmV0UGxhbnM=','bWVzc2FnZQ==','aW52YWxpZEJ1c2luZXNzSWQ=','c3RhdHVz','UFVQTElDX0lOVEVSTkVUX1BMQU4=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','d2Fybg==','ZGVidWc=','aW5mbw==','ZXJyb3I=','ZXhjZXB0aW9u','dHJhY2U=','bG9n','Li4vLi4vc2VydmVyL3NlcnZlcg==','Li4vLi4vc2VydmVyL21vZHVsZXMvdXRpbGl0eQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmlnLmpz','Li4vLi4vc2VydmVyL21vZHVsZXMvbG9nZ2Vy','Y3JlYXRlTG9nZ2Vy','Li4vLi4vc2VydmVyL21vZHVsZXMvaHNwQ2FjaGU=','YWZ0ZXIgc2F2ZQ==','QnVzaW5lc3M=','aXNOZXdJbnN0YW5jZQ==','cmVhZEZyb21DYWNoZQ==','ZmluZEJ5SWQ=','Y2FjaGVJdA==','YXNzaWduUGxhblRvTWVtYmVy','QGFzc2lnblBsYW5Ub01lbWJlcg==','bW9kZWxz','UHJvbWlzZQ==','dGhlbg==','bm8gc3VjaCBwbGFu','cGxhbiBub3QgZm91bmQg','cHJpY2U=','bm90IGEgZnJlZSBwbGFu','bWVtYmVyIG5vdCBmb3VuZA==','YnVzaW5lc3NJZA==','aW52YWxpZCBidXNpbmVzcyBpZA==','dG9TdHJpbmc=','YnVzaW5lc3Mgbm90IGZvdW5k','ZGVmYXVsdEludGVybmV0UGxhbg==','YWN0aXZhdGVEZWZhdWx0UGxhbkNvdW50','QUdHUkVHQVRF','SE9VUl9NSUxMSVNFQ09ORFM=','c3Vic2NyaXB0aW9uRGF0ZQ==','Z2V0VGltZQ==','Y291bnQ=','ZGVmYXVsdCBwbGFuIGFjdGl2YXRlZCB0b28gbWFueSB0aW1lcw==','dXBkYXRlQXR0cmlidXRlcw==','dXBkYXRlSW50ZXJuZXRQbGFuSGlzdG9yeQ==','cGxhbiBhc3NpZ25lZCA6','ZmFpbA==','Y2FsY3VsYXRlUHJldmlld3NQbGFuVXNhZ2U=','TWVtYmVy','Ly8vLy8vLy8vLw==','YXNzaWduRGF0ZQ==','dG90YWxVc2FnZQ==','YnVsaw==','ZmFpbGVkIHRvIGxvYWQgb2xkIHBsYW4gdXNhZ2Ug','QHVwZGF0ZUludGVybmV0UGxhbkhpc3Rvcnk=','aW50ZXJuZXRQbGFuSGlzdG9yeQ==','cG9w','cHVzaA==','bGVuZ3Ro','aW50ZXJuZXQgcGxhbiBoaXN0b3J5IHVwZGF0ZSByZXN1bHQ6','ZmFpbGVkIHRvIGFkZCBvbGQgcGxhbiB1c2FnZQ==','cmVtb3RlTWV0aG9k','bWVtYmVySWQ=','c3RyaW5n','cGxhbklk','aXNGcmVl','Ym9vbGVhbg==','YnlCdXNpbmVzcw==','QGFzc2lnbkZyZWVQbGFuVG9NZW1iZXI='];(function(_0x5520dc,_0x21e704){var _0x39c4e5=function(_0x13569b){while(--_0x13569b){_0x5520dc['push'](_0x5520dc['shift']());}};var _0x1548d1=function(){var _0x1fa4c0={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x184286,_0x4c8607,_0x204824,_0x16c5d3){_0x16c5d3=_0x16c5d3||{};var _0x4d8e41=_0x4c8607+'='+_0x204824;var _0x1a7160=0x0;for(var _0x1a7160=0x0,_0x3cbda1=_0x184286['length'];_0x1a7160<_0x3cbda1;_0x1a7160++){var _0xdc3769=_0x184286[_0x1a7160];_0x4d8e41+=';\x20'+_0xdc3769;var _0x346d2d=_0x184286[_0xdc3769];_0x184286['push'](_0x346d2d);_0x3cbda1=_0x184286['length'];if(_0x346d2d!==!![]){_0x4d8e41+='='+_0x346d2d;}}_0x16c5d3['cookie']=_0x4d8e41;},'removeCookie':function(){return'dev';},'getCookie':function(_0x57c060,_0x3ecd31){_0x57c060=_0x57c060||function(_0x2a9bd7){return _0x2a9bd7;};var _0x5be5ce=_0x57c060(new RegExp('(?:^|;\x20)'+_0x3ecd31['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x2935f8=function(_0x4633ae,_0x423644){_0x4633ae(++_0x423644);};_0x2935f8(_0x39c4e5,_0x21e704);return _0x5be5ce?decodeURIComponent(_0x5be5ce[0x1]):undefined;}};var _0x52063e=function(){var _0x5c5b0c=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x5c5b0c['test'](_0x1fa4c0['removeCookie']['toString']());};_0x1fa4c0['updateCookie']=_0x52063e;var _0x51d9d7='';var _0x3c7ad1=_0x1fa4c0['updateCookie']();if(!_0x3c7ad1){_0x1fa4c0['setCookie'](['*'],'counter',0x1);}else if(_0x3c7ad1){_0x51d9d7=_0x1fa4c0['getCookie'](null,'counter');}else{_0x1fa4c0['removeCookie']();}};_0x1548d1();}(_0x0a53,0xee));var _0x30a5=function(_0x54b283,_0x5eb8a6){_0x54b283=_0x54b283-0x0;var _0x2462b3=_0x0a53[_0x54b283];if(_0x30a5['initialized']===undefined){(function(){var _0x136b1a;try{var _0x18b1d2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x136b1a=_0x18b1d2();}catch(_0x298de3){_0x136b1a=window;}var _0x3fd8d5='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x136b1a['atob']||(_0x136b1a['atob']=function(_0x36699b){var _0x2f2b69=String(_0x36699b)['replace'](/=+$/,'');for(var _0x5b10c6=0x0,_0x402bfc,_0x31e744,_0x2974d5=0x0,_0xf0ffb3='';_0x31e744=_0x2f2b69['charAt'](_0x2974d5++);~_0x31e744&&(_0x402bfc=_0x5b10c6%0x4?_0x402bfc*0x40+_0x31e744:_0x31e744,_0x5b10c6++%0x4)?_0xf0ffb3+=String['fromCharCode'](0xff&_0x402bfc>>(-0x2*_0x5b10c6&0x6)):0x0){_0x31e744=_0x3fd8d5['indexOf'](_0x31e744);}return _0xf0ffb3;});}());_0x30a5['base64DecodeUnicode']=function(_0x104682){var _0x44fea6=atob(_0x104682);var _0x4a0662=[];for(var _0x3a89e3=0x0,_0x194853=_0x44fea6['length'];_0x3a89e3<_0x194853;_0x3a89e3++){_0x4a0662+='%'+('00'+_0x44fea6['charCodeAt'](_0x3a89e3)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4a0662);};_0x30a5['data']={};_0x30a5['initialized']=!![];}var _0x592008=_0x30a5['data'][_0x54b283];if(_0x592008===undefined){var _0x38991f=function(_0x363642){this['rc4Bytes']=_0x363642;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x38991f['prototype']['checkState']=function(){var _0x4d8354=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x4d8354['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x38991f['prototype']['runState']=function(_0x3464af){if(!Boolean(~_0x3464af)){return _0x3464af;}return this['getState'](this['rc4Bytes']);};_0x38991f['prototype']['getState']=function(_0x1bf29c){for(var _0x3493fb=0x0,_0xbdd68f=this['states']['length'];_0x3493fb<_0xbdd68f;_0x3493fb++){this['states']['push'](Math['round'](Math['random']()));_0xbdd68f=this['states']['length'];}return _0x1bf29c(this['states'][0x0]);};new _0x38991f(_0x30a5)['checkState']();_0x2462b3=_0x30a5['base64DecodeUnicode'](_0x2462b3);_0x30a5['data'][_0x54b283]=_0x2462b3;}else{_0x2462b3=_0x592008;}return _0x2462b3;};var _0x31642b=function(){var _0x5b15ee=!![];return function(_0x1e59ad,_0x30e5f8){var _0x118286=_0x5b15ee?function(){if(_0x30e5f8){var _0x2d3eab=_0x30e5f8['apply'](_0x1e59ad,arguments);_0x30e5f8=null;return _0x2d3eab;}}:function(){};_0x5b15ee=![];return _0x118286;};}();var _0x296be9=_0x31642b(this,function(){var _0x5cfd57=function(){return'\x64\x65\x76';},_0x2a74c2=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x4926af=function(){var _0x4c7f67=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x4c7f67['\x74\x65\x73\x74'](_0x5cfd57['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0xad7403=function(){var _0xd7c500=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0xd7c500['\x74\x65\x73\x74'](_0x2a74c2['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x5db0b9=function(_0x57eb0b){var _0x5eccbf=~-0x1>>0x1+0xff%0x0;if(_0x57eb0b['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x5eccbf)){_0x3a82cd(_0x57eb0b);}};var _0x3a82cd=function(_0x294264){var _0xa61162=~-0x4>>0x1+0xff%0x0;if(_0x294264['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0xa61162){_0x5db0b9(_0x294264);}};if(!_0x4926af()){if(!_0xad7403()){_0x5db0b9('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x5db0b9('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x5db0b9('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x296be9();var _0x36ddbb=function(){var _0x4d0e1a=!![];return function(_0x567359,_0x2ef883){var _0x575521=_0x4d0e1a?function(){if(_0x2ef883){var _0x54b5b3=_0x2ef883['apply'](_0x567359,arguments);_0x2ef883=null;return _0x54b5b3;}}:function(){};_0x4d0e1a=![];return _0x575521;};}();var _0x28e0c2=_0x36ddbb(this,function(){var _0x2106a7=function(){};var _0x448020;try{var _0x48601a=Function(_0x30a5('0x0')+_0x30a5('0x1')+');');_0x448020=_0x48601a();}catch(_0x342713){_0x448020=window;}if(!_0x448020['console']){_0x448020[_0x30a5('0x2')]=function(_0x5945c6){var _0x3499b={};_0x3499b['log']=_0x5945c6;_0x3499b[_0x30a5('0x3')]=_0x5945c6;_0x3499b[_0x30a5('0x4')]=_0x5945c6;_0x3499b[_0x30a5('0x5')]=_0x5945c6;_0x3499b[_0x30a5('0x6')]=_0x5945c6;_0x3499b[_0x30a5('0x7')]=_0x5945c6;_0x3499b[_0x30a5('0x8')]=_0x5945c6;return _0x3499b;}(_0x2106a7);}else{_0x448020['console'][_0x30a5('0x9')]=_0x2106a7;_0x448020[_0x30a5('0x2')][_0x30a5('0x3')]=_0x2106a7;_0x448020['console']['debug']=_0x2106a7;_0x448020[_0x30a5('0x2')][_0x30a5('0x5')]=_0x2106a7;_0x448020['console'][_0x30a5('0x6')]=_0x2106a7;_0x448020[_0x30a5('0x2')]['exception']=_0x2106a7;_0x448020[_0x30a5('0x2')][_0x30a5('0x8')]=_0x2106a7;}});_0x28e0c2();var app=require(_0x30a5('0xa'));var utility=require(_0x30a5('0xb'));var Q=require('q');var config=require(_0x30a5('0xc'));var logger=require(_0x30a5('0xd'));var log=logger[_0x30a5('0xe')]();var hotspotMessages=require('../../server/modules/hotspotMessages');const hspCache=require(_0x30a5('0xf'));module['exports']=function(_0x5f1573){_0x5f1573['observe'](_0x30a5('0x10'),function(_0x146bb6,_0x85746a){var _0x296336=app['models'][_0x30a5('0x11')];if(_0x146bb6[_0x30a5('0x12')]){var _0x12f656=_0x146bb6['instance'];_0x85746a();}else{_0x85746a();}});_0x5f1573['loadById']=async function(_0x41d165){const _0x2b9193=await hspCache[_0x30a5('0x13')](_0x41d165);if(_0x2b9193){return _0x2b9193;}const _0x27414b=await _0x5f1573[_0x30a5('0x14')](_0x41d165);log['warn']('from\x20db...',_0x27414b);hspCache[_0x30a5('0x15')](_0x41d165,_0x27414b);return _0x27414b;};_0x5f1573[_0x30a5('0x16')]=function(_0x160bab,_0x344f53,_0x25a2d2){log[_0x30a5('0x4')](_0x30a5('0x17'));var _0x4b86d7=app[_0x30a5('0x18')]['Member'];return Q[_0x30a5('0x19')](function(_0x59d129,_0xb13988){_0x5f1573[_0x30a5('0x14')](_0x344f53)[_0x30a5('0x1a')](function(_0x5b6c49){if(!_0x5b6c49){log[_0x30a5('0x6')](_0x30a5('0x1b'));return _0xb13988(_0x30a5('0x1c'),_0x344f53);}if(_0x25a2d2&&_0x5b6c49[_0x30a5('0x1d')]!==0x0){return _0xb13988(_0x30a5('0x1e'),_0x344f53);}_0x4b86d7[_0x30a5('0x14')](_0x160bab)[_0x30a5('0x1a')](function(_0xf18bf7){if(!_0xf18bf7){log[_0x30a5('0x6')]('member\x20not\x20found');return _0xb13988(_0x30a5('0x1f'));}if(!_0xf18bf7[_0x30a5('0x20')]||!_0x5b6c49[_0x30a5('0x20')]){return _0xb13988(_0x30a5('0x21'));}if(_0xf18bf7[_0x30a5('0x20')][_0x30a5('0x22')]()!==_0x5b6c49[_0x30a5('0x20')]['toString']()){return _0xb13988('member\x20and\x20business\x20plan\x20mismatch');}var _0x56659f=app[_0x30a5('0x18')][_0x30a5('0x11')];_0x56659f[_0x30a5('0x14')](_0xf18bf7['businessId'])[_0x30a5('0x1a')](function(_0x271d05){if(!_0x271d05){log[_0x30a5('0x6')]('business\x20not\x20found');return _0xb13988(_0x30a5('0x23'));}var _0x17c173=new Date()['getTime']();var _0x46e4b3=_0x17c173;var _0xd686ab=0x0;if(_0x25a2d2&&(_0x271d05[_0x30a5('0x24')]&&_0x271d05[_0x30a5('0x24')]['id'])&&_0x5b6c49['id']==_0x271d05['defaultInternetPlan']['id']){_0xd686ab=0x1;if(_0xf18bf7[_0x30a5('0x25')]){_0xd686ab=_0xf18bf7[_0x30a5('0x25')]||0x0;var _0x5db34e=_0x271d05[_0x30a5('0x24')]['period']*config[_0x30a5('0x26')][_0x30a5('0x27')];if(_0xf18bf7['subscriptionDate']){_0x46e4b3=new Date(_0xf18bf7[_0x30a5('0x28')])[_0x30a5('0x29')]();}var _0x15e528=_0x46e4b3+_0x5db34e;if(_0x15e528>_0x17c173&&_0xf18bf7['activateDefaultPlanCount']<_0x271d05[_0x30a5('0x24')][_0x30a5('0x2a')]){_0xd686ab=_0xf18bf7[_0x30a5('0x25')]+0x1;}else if(_0x15e528<_0x17c173){_0x46e4b3=_0x17c173;}else{log[_0x30a5('0x6')](_0x30a5('0x2b'));return _0xb13988(_0x30a5('0x2b'));}}}_0xf18bf7[_0x30a5('0x2c')]({'internetPlanId':_0x5b6c49['id'],'internetPlanName':_0x5b6c49['name'],'subscriptionDate':_0x46e4b3,'activateDefaultPlanCount':_0xd686ab,'extraBulk':0x0},function(_0x2379ae,_0x4669b8){if(_0x2379ae){log[_0x30a5('0x6')](_0x2379ae);return _0xb13988(_0x2379ae);}_0x5f1573[_0x30a5('0x2d')](_0x160bab,_0x344f53)[_0x30a5('0x1a')](function(){log[_0x30a5('0x4')](_0x30a5('0x2e'),_0x4669b8);return _0x59d129();})[_0x30a5('0x2f')](function(_0x52bcd3){log[_0x30a5('0x6')](_0x52bcd3);return _0xb13988(_0x52bcd3);});});});});});});};_0x5f1573[_0x30a5('0x30')]=(_0x9a6e1,_0x249f17,_0x556ed8)=>{var _0x3d0814=app['models'][_0x30a5('0x31')];return Q['Promise']((_0x545942,_0xd79266)=>{log[_0x30a5('0x4')](_0x30a5('0x32'));log[_0x30a5('0x4')](_0x249f17);log[_0x30a5('0x4')](_0x9a6e1);log[_0x30a5('0x4')](_0x556ed8);if(_0x556ed8){const _0x182ec3=new Date()[_0x30a5('0x29')]();_0x3d0814['getInternetUsage'](_0x9a6e1,_0x249f17,_0x556ed8[_0x30a5('0x33')],_0x182ec3)[_0x30a5('0x1a')](_0x3f07ae=>{log['debug'](_0x3f07ae);_0x556ed8[_0x30a5('0x34')]=_0x3f07ae[_0x30a5('0x35')]||0x0;return _0x545942(_0x556ed8);})[_0x30a5('0x2f')](_0x4b0317=>{log[_0x30a5('0x6')](_0x4b0317);return _0xd79266(_0x30a5('0x36'));});}else{return _0x545942();}});};_0x5f1573[_0x30a5('0x2d')]=function(_0x1036f9,_0x544e70){log[_0x30a5('0x4')](_0x30a5('0x37'));var _0x58c714=app['models'][_0x30a5('0x31')];return Q['Promise'](function(_0x182891,_0x33e28e){_0x5f1573['findById'](_0x544e70)[_0x30a5('0x1a')](function(_0x1e80d0){if(!_0x1e80d0){log[_0x30a5('0x6')](_0x30a5('0x1b'));return _0x33e28e(_0x30a5('0x1c'),_0x544e70);}_0x58c714[_0x30a5('0x14')](_0x1036f9)[_0x30a5('0x1a')](function(_0x263d16){if(!_0x263d16){log[_0x30a5('0x6')](_0x30a5('0x1f'));return _0x33e28e(_0x30a5('0x1f'));}var _0x2196b4=_0x263d16[_0x30a5('0x38')]||[];_0x5f1573['calculatePreviewsPlanUsage'](_0x263d16[_0x30a5('0x20')],_0x1036f9,_0x2196b4[_0x30a5('0x39')]())[_0x30a5('0x1a')](_0x5dc2e2=>{if(_0x5dc2e2){_0x2196b4[_0x30a5('0x3a')](_0x5dc2e2);}var _0x2f3209=_0x1e80d0;_0x2f3209[_0x30a5('0x33')]=new Date()[_0x30a5('0x29')]();_0x2196b4[_0x30a5('0x3a')](_0x2f3209);if(_0x2196b4[_0x30a5('0x3b')]>0x14){_0x2196b4=_0x2196b4['splice'](_0x2196b4['length']-0x14);}_0x263d16[_0x30a5('0x2c')]({'internetPlanHistory':_0x2196b4},function(_0x479749,_0x432c0b){if(_0x479749){log[_0x30a5('0x6')](_0x479749);return _0x33e28e(_0x479749);}log['debug'](_0x30a5('0x3c'),_0x432c0b);return _0x182891();});})[_0x30a5('0x2f')](_0x30f3a0=>{log[_0x30a5('0x6')](_0x30f3a0);return _0x33e28e(_0x30a5('0x3d'));});});});});};_0x5f1573[_0x30a5('0x3e')](_0x30a5('0x16'),{'accepts':[{'arg':_0x30a5('0x3f'),'type':_0x30a5('0x40'),'required':!![]},{'arg':_0x30a5('0x41'),'type':_0x30a5('0x40'),'required':!![]},{'arg':_0x30a5('0x42'),'type':_0x30a5('0x43')},{'arg':_0x30a5('0x44'),'type':_0x30a5('0x43')}],'returns':{'root':!![]}});_0x5f1573['assignFreePlanToMember']=function(_0x4ec78f,_0x2fb4f2,_0x3b41ae){log[_0x30a5('0x4')](_0x30a5('0x45'));_0x5f1573[_0x30a5('0x16')](_0x4ec78f,_0x2fb4f2,!![])['then'](function(){return _0x3b41ae(null,{'ok':!![]});})[_0x30a5('0x2f')](function(_0x2108a8){log[_0x30a5('0x6')](_0x2108a8);return _0x3b41ae(_0x2108a8);});};_0x5f1573[_0x30a5('0x3e')](_0x30a5('0x46'),{'accepts':[{'arg':'memberId','type':_0x30a5('0x40'),'required':!![]},{'arg':_0x30a5('0x41'),'type':_0x30a5('0x40'),'required':!![]}],'returns':{'root':!![]}});_0x5f1573[_0x30a5('0x47')]=function(_0x587b0a,_0x803124){log['debug'](_0x30a5('0x48'));if(!_0x587b0a){var _0x49b3d8=new Error();_0x49b3d8[_0x30a5('0x49')]=hotspotMessages[_0x30a5('0x4a')];_0x49b3d8[_0x30a5('0x4b')]=0x194;return _0x803124(_0x49b3d8);}_0x5f1573['find']({'where':{'and':[{'businessId':_0x587b0a},{'accessType':config[_0x30a5('0x4c')]}]}},function(_0xe29f8f,_0x68d940){if(_0xe29f8f){log[_0x30a5('0x6')](_0xe29f8f);return _0x803124(_0xe29f8f);}return _0x803124(null,_0x68d940);});};_0x5f1573['remoteMethod'](_0x30a5('0x47'),{'accepts':[{'arg':'businessId','type':'string','required':!![]}],'returns':{'root':!![]}});};