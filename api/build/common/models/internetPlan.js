var _0x8ed6=['ZmluZEJ5SWQ=','Y2FjaGVJdA==','YXNzaWduUGxhblRvTWVtYmVy','QGFzc2lnblBsYW5Ub01lbWJlcg==','TWVtYmVy','UHJvbWlzZQ==','dGhlbg==','bm8gc3VjaCBwbGFu','cGxhbiBub3QgZm91bmQg','cHJpY2U=','bm90IGEgZnJlZSBwbGFu','bWVtYmVyIG5vdCBmb3VuZA==','YnVzaW5lc3NJZA==','dG9TdHJpbmc=','YnVzaW5lc3Mgbm90IGZvdW5k','ZGVmYXVsdEludGVybmV0UGxhbg==','YWN0aXZhdGVEZWZhdWx0UGxhbkNvdW50','cGVyaW9k','SE9VUl9NSUxMSVNFQ09ORFM=','c3Vic2NyaXB0aW9uRGF0ZQ==','Z2V0VGltZQ==','ZGVmYXVsdCBwbGFuIGFjdGl2YXRlZCB0b28gbWFueSB0aW1lcw==','dXBkYXRlQXR0cmlidXRlcw==','cGxhbiBhc3NpZ25lZCA6','Y2FsY3VsYXRlUHJldmlld3NQbGFuVXNhZ2U=','Ly8vLy8vLy8vLw==','Z2V0SW50ZXJuZXRVc2FnZQ==','YXNzaWduRGF0ZQ==','dG90YWxVc2FnZQ==','YnVsaw==','ZmFpbA==','aW50ZXJuZXRQbGFuSGlzdG9yeQ==','cG9w','cHVzaA==','bGVuZ3Ro','c3BsaWNl','aW50ZXJuZXQgcGxhbiBoaXN0b3J5IHVwZGF0ZSByZXN1bHQ6','ZmFpbGVkIHRvIGFkZCBvbGQgcGxhbiB1c2FnZQ==','cmVtb3RlTWV0aG9k','bWVtYmVySWQ=','cGxhbklk','aXNGcmVl','Ym9vbGVhbg==','YnlCdXNpbmVzcw==','YXNzaWduRnJlZVBsYW5Ub01lbWJlcg==','QGFzc2lnbkZyZWVQbGFuVG9NZW1iZXI=','c3RyaW5n','Z2V0UHVibGljSW50ZXJuZXRQbGFucw==','QGdldFB1YmxpY0ludGVybmV0UGxhbnM=','bWVzc2FnZQ==','c3RhdHVz','UFVQTElDX0lOVEVSTkVUX1BMQU4=','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','bG9n','d2Fybg==','ZGVidWc=','aW5mbw==','dHJhY2U=','ZXJyb3I=','ZXhjZXB0aW9u','Li4vLi4vc2VydmVyL3NlcnZlcg==','Li4vLi4vc2VydmVyL21vZHVsZXMvdXRpbGl0eQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvbG9nZ2Vy','Y3JlYXRlTG9nZ2Vy','Li4vLi4vc2VydmVyL21vZHVsZXMvaG90c3BvdE1lc3NhZ2Vz','b2JzZXJ2ZQ==','YWZ0ZXIgc2F2ZQ==','bW9kZWxz','QnVzaW5lc3M=','aXNOZXdJbnN0YW5jZQ==','bG9hZEJ5SWQ='];(function(_0x210103,_0x5e7038){var _0x15a731=function(_0x46d3ce){while(--_0x46d3ce){_0x210103['push'](_0x210103['shift']());}};var _0x301414=function(){var _0x4c49d8={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x189712,_0x3f170c,_0x1857e0,_0x326fb){_0x326fb=_0x326fb||{};var _0x53ce04=_0x3f170c+'='+_0x1857e0;var _0x1d2f5f=0x0;for(var _0x1d2f5f=0x0,_0x4f2722=_0x189712['length'];_0x1d2f5f<_0x4f2722;_0x1d2f5f++){var _0x1a2c10=_0x189712[_0x1d2f5f];_0x53ce04+=';\x20'+_0x1a2c10;var _0x6c5cb=_0x189712[_0x1a2c10];_0x189712['push'](_0x6c5cb);_0x4f2722=_0x189712['length'];if(_0x6c5cb!==!![]){_0x53ce04+='='+_0x6c5cb;}}_0x326fb['cookie']=_0x53ce04;},'removeCookie':function(){return'dev';},'getCookie':function(_0x5a31e6,_0xcf5b7b){_0x5a31e6=_0x5a31e6||function(_0x5a9230){return _0x5a9230;};var _0x14ac24=_0x5a31e6(new RegExp('(?:^|;\x20)'+_0xcf5b7b['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x565698=function(_0x3306e1,_0x5d65e8){_0x3306e1(++_0x5d65e8);};_0x565698(_0x15a731,_0x5e7038);return _0x14ac24?decodeURIComponent(_0x14ac24[0x1]):undefined;}};var _0x4ee598=function(){var _0x1aa34c=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x1aa34c['test'](_0x4c49d8['removeCookie']['toString']());};_0x4c49d8['updateCookie']=_0x4ee598;var _0x2a3726='';var _0x4ab37a=_0x4c49d8['updateCookie']();if(!_0x4ab37a){_0x4c49d8['setCookie'](['*'],'counter',0x1);}else if(_0x4ab37a){_0x2a3726=_0x4c49d8['getCookie'](null,'counter');}else{_0x4c49d8['removeCookie']();}};_0x301414();}(_0x8ed6,0x1a6));var _0x68ed=function(_0x3ab51d,_0x2fa01d){_0x3ab51d=_0x3ab51d-0x0;var _0x29a04e=_0x8ed6[_0x3ab51d];if(_0x68ed['initialized']===undefined){(function(){var _0x1ffbbf;try{var _0x18bf2d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1ffbbf=_0x18bf2d();}catch(_0x26844b){_0x1ffbbf=window;}var _0x1ba0bb='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x1ffbbf['atob']||(_0x1ffbbf['atob']=function(_0x455700){var _0x2ad237=String(_0x455700)['replace'](/=+$/,'');for(var _0x4e0313=0x0,_0x4941f1,_0x41a183,_0x57effd=0x0,_0xc1278f='';_0x41a183=_0x2ad237['charAt'](_0x57effd++);~_0x41a183&&(_0x4941f1=_0x4e0313%0x4?_0x4941f1*0x40+_0x41a183:_0x41a183,_0x4e0313++%0x4)?_0xc1278f+=String['fromCharCode'](0xff&_0x4941f1>>(-0x2*_0x4e0313&0x6)):0x0){_0x41a183=_0x1ba0bb['indexOf'](_0x41a183);}return _0xc1278f;});}());_0x68ed['base64DecodeUnicode']=function(_0x6030ae){var _0x69bc41=atob(_0x6030ae);var _0x2c4e2e=[];for(var _0x436234=0x0,_0x511d53=_0x69bc41['length'];_0x436234<_0x511d53;_0x436234++){_0x2c4e2e+='%'+('00'+_0x69bc41['charCodeAt'](_0x436234)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2c4e2e);};_0x68ed['data']={};_0x68ed['initialized']=!![];}var _0x11c586=_0x68ed['data'][_0x3ab51d];if(_0x11c586===undefined){var _0x42e4f8=function(_0x1d13fb){this['rc4Bytes']=_0x1d13fb;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x42e4f8['prototype']['checkState']=function(){var _0x4487ca=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x4487ca['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x42e4f8['prototype']['runState']=function(_0x4c7d3a){if(!Boolean(~_0x4c7d3a)){return _0x4c7d3a;}return this['getState'](this['rc4Bytes']);};_0x42e4f8['prototype']['getState']=function(_0x5ab4a3){for(var _0x451ea6=0x0,_0x313e73=this['states']['length'];_0x451ea6<_0x313e73;_0x451ea6++){this['states']['push'](Math['round'](Math['random']()));_0x313e73=this['states']['length'];}return _0x5ab4a3(this['states'][0x0]);};new _0x42e4f8(_0x68ed)['checkState']();_0x29a04e=_0x68ed['base64DecodeUnicode'](_0x29a04e);_0x68ed['data'][_0x3ab51d]=_0x29a04e;}else{_0x29a04e=_0x11c586;}return _0x29a04e;};var _0x2a8f9b=function(){var _0xe16c08=!![];return function(_0x251274,_0x3a7959){var _0x7709b1=_0xe16c08?function(){if(_0x3a7959){var _0x41b7cf=_0x3a7959['apply'](_0x251274,arguments);_0x3a7959=null;return _0x41b7cf;}}:function(){};_0xe16c08=![];return _0x7709b1;};}();var _0x4ad3c0=_0x2a8f9b(this,function(){var _0x2c7618=function(){return'\x64\x65\x76';},_0x26be9c=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x2e2d5f=function(){var _0x430d39=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x430d39['\x74\x65\x73\x74'](_0x2c7618['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x52772b=function(){var _0x175479=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x175479['\x74\x65\x73\x74'](_0x26be9c['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x503770=function(_0x435076){var _0x4c9c86=~-0x1>>0x1+0xff%0x0;if(_0x435076['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x4c9c86)){_0x2a77c7(_0x435076);}};var _0x2a77c7=function(_0xef6f5a){var _0x3c5f54=~-0x4>>0x1+0xff%0x0;if(_0xef6f5a['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x3c5f54){_0x503770(_0xef6f5a);}};if(!_0x2e2d5f()){if(!_0x52772b()){_0x503770('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x503770('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x503770('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x4ad3c0();var _0x2dc6b8=function(){var _0x4219c7=!![];return function(_0x30c52b,_0x413e69){var _0x4f5ef7=_0x4219c7?function(){if(_0x413e69){var _0x5222ea=_0x413e69[_0x68ed('0x0')](_0x30c52b,arguments);_0x413e69=null;return _0x5222ea;}}:function(){};_0x4219c7=![];return _0x4f5ef7;};}();var _0x1b8f91=_0x2dc6b8(this,function(){var _0x113618=function(){};var _0x3df4a1;try{var _0x5b7ef9=Function(_0x68ed('0x1')+_0x68ed('0x2')+');');_0x3df4a1=_0x5b7ef9();}catch(_0x333ff0){_0x3df4a1=window;}if(!_0x3df4a1[_0x68ed('0x3')]){_0x3df4a1[_0x68ed('0x3')]=function(_0x56c9ef){var _0x44c2ab={};_0x44c2ab[_0x68ed('0x4')]=_0x56c9ef;_0x44c2ab[_0x68ed('0x5')]=_0x56c9ef;_0x44c2ab[_0x68ed('0x6')]=_0x56c9ef;_0x44c2ab[_0x68ed('0x7')]=_0x56c9ef;_0x44c2ab['error']=_0x56c9ef;_0x44c2ab['exception']=_0x56c9ef;_0x44c2ab[_0x68ed('0x8')]=_0x56c9ef;return _0x44c2ab;}(_0x113618);}else{_0x3df4a1['console'][_0x68ed('0x4')]=_0x113618;_0x3df4a1[_0x68ed('0x3')]['warn']=_0x113618;_0x3df4a1['console'][_0x68ed('0x6')]=_0x113618;_0x3df4a1[_0x68ed('0x3')][_0x68ed('0x7')]=_0x113618;_0x3df4a1[_0x68ed('0x3')][_0x68ed('0x9')]=_0x113618;_0x3df4a1['console'][_0x68ed('0xa')]=_0x113618;_0x3df4a1[_0x68ed('0x3')]['trace']=_0x113618;}});_0x1b8f91();var app=require(_0x68ed('0xb'));var utility=require(_0x68ed('0xc'));var Q=require('q');var config=require('../../server/modules/config.js');var logger=require(_0x68ed('0xd'));var log=logger[_0x68ed('0xe')]();var hotspotMessages=require(_0x68ed('0xf'));const hspCache=require('../../server/modules/hspCache');module['exports']=function(_0x1fe9f2){_0x1fe9f2[_0x68ed('0x10')](_0x68ed('0x11'),function(_0x4298dc,_0x513230){var _0x17d802=app[_0x68ed('0x12')][_0x68ed('0x13')];if(_0x4298dc[_0x68ed('0x14')]){var _0x394184=_0x4298dc['instance'];_0x513230();}else{_0x513230();}});_0x1fe9f2[_0x68ed('0x15')]=async function(_0x494e2c){const _0x5de9ac=await hspCache['readFromCache'](_0x494e2c);if(_0x5de9ac){return _0x5de9ac;}const _0x5ceef8=await _0x1fe9f2[_0x68ed('0x16')](_0x494e2c);log['warn']('from\x20db...',_0x5ceef8);hspCache[_0x68ed('0x17')](_0x494e2c,_0x5ceef8);return _0x5ceef8;};_0x1fe9f2[_0x68ed('0x18')]=function(_0x5a29a2,_0x271d79,_0x34657d){log[_0x68ed('0x6')](_0x68ed('0x19'));var _0x17b712=app[_0x68ed('0x12')][_0x68ed('0x1a')];return Q[_0x68ed('0x1b')](function(_0x12cd5c,_0x4787bc){_0x1fe9f2[_0x68ed('0x16')](_0x271d79)[_0x68ed('0x1c')](function(_0x325c9a){if(!_0x325c9a){log['error'](_0x68ed('0x1d'));return _0x4787bc(_0x68ed('0x1e'),_0x271d79);}if(_0x34657d&&_0x325c9a[_0x68ed('0x1f')]!==0x0){return _0x4787bc(_0x68ed('0x20'),_0x271d79);}_0x17b712[_0x68ed('0x16')](_0x5a29a2)[_0x68ed('0x1c')](function(_0x4cd46a){if(!_0x4cd46a){log['error'](_0x68ed('0x21'));return _0x4787bc(_0x68ed('0x21'));}if(!_0x4cd46a['businessId']||!_0x325c9a[_0x68ed('0x22')]){return _0x4787bc('invalid\x20business\x20id');}if(_0x4cd46a[_0x68ed('0x22')][_0x68ed('0x23')]()!==_0x325c9a[_0x68ed('0x22')][_0x68ed('0x23')]()){return _0x4787bc('member\x20and\x20business\x20plan\x20mismatch');}var _0x42bc71=app[_0x68ed('0x12')]['Business'];_0x42bc71[_0x68ed('0x16')](_0x4cd46a['businessId'])[_0x68ed('0x1c')](function(_0x191325){if(!_0x191325){log[_0x68ed('0x9')](_0x68ed('0x24'));return _0x4787bc('business\x20not\x20found');}var _0x26d7a6=new Date()['getTime']();var _0x2e8600=_0x26d7a6;var _0x42f32f=0x0;if(_0x34657d&&(_0x191325[_0x68ed('0x25')]&&_0x191325[_0x68ed('0x25')]['id'])&&_0x325c9a['id']==_0x191325[_0x68ed('0x25')]['id']){_0x42f32f=0x1;if(_0x4cd46a[_0x68ed('0x26')]){_0x42f32f=_0x4cd46a[_0x68ed('0x26')]||0x0;var _0x380be2=_0x191325[_0x68ed('0x25')][_0x68ed('0x27')]*config['AGGREGATE'][_0x68ed('0x28')];if(_0x4cd46a[_0x68ed('0x29')]){_0x2e8600=new Date(_0x4cd46a[_0x68ed('0x29')])[_0x68ed('0x2a')]();}var _0x541776=_0x2e8600+_0x380be2;if(_0x541776>_0x26d7a6&&_0x4cd46a[_0x68ed('0x26')]<_0x191325[_0x68ed('0x25')]['count']){_0x42f32f=_0x4cd46a['activateDefaultPlanCount']+0x1;}else if(_0x541776<_0x26d7a6){_0x2e8600=_0x26d7a6;}else{log['error'](_0x68ed('0x2b'));return _0x4787bc('default\x20plan\x20activated\x20too\x20many\x20times');}}}_0x4cd46a[_0x68ed('0x2c')]({'internetPlanId':_0x325c9a['id'],'internetPlanName':_0x325c9a['name'],'subscriptionDate':_0x2e8600,'activateDefaultPlanCount':_0x42f32f,'extraBulk':0x0},function(_0x56d727,_0x49edfd){if(_0x56d727){log[_0x68ed('0x9')](_0x56d727);return _0x4787bc(_0x56d727);}_0x1fe9f2['updateInternetPlanHistory'](_0x5a29a2,_0x271d79)[_0x68ed('0x1c')](function(){log[_0x68ed('0x6')](_0x68ed('0x2d'),_0x49edfd);return _0x12cd5c();})['fail'](function(_0x1826f5){log[_0x68ed('0x9')](_0x1826f5);return _0x4787bc(_0x1826f5);});});});});});});};_0x1fe9f2[_0x68ed('0x2e')]=(_0x27a3d2,_0x26d30d,_0x123223)=>{var _0x1618f8=app[_0x68ed('0x12')][_0x68ed('0x1a')];return Q[_0x68ed('0x1b')]((_0xf04adb,_0x1de6be)=>{log[_0x68ed('0x6')](_0x68ed('0x2f'));log['debug'](_0x26d30d);log[_0x68ed('0x6')](_0x27a3d2);log['debug'](_0x123223);if(_0x123223){const _0x50d587=new Date()[_0x68ed('0x2a')]();_0x1618f8[_0x68ed('0x30')](_0x27a3d2,_0x26d30d,_0x123223[_0x68ed('0x31')],_0x50d587)[_0x68ed('0x1c')](_0x1b7011=>{log[_0x68ed('0x6')](_0x1b7011);_0x123223[_0x68ed('0x32')]=_0x1b7011[_0x68ed('0x33')]||0x0;return _0xf04adb(_0x123223);})[_0x68ed('0x34')](_0x3f0ad2=>{log[_0x68ed('0x9')](_0x3f0ad2);return _0x1de6be('failed\x20to\x20load\x20old\x20plan\x20usage\x20');});}else{return _0xf04adb();}});};_0x1fe9f2['updateInternetPlanHistory']=function(_0x28294b,_0x525d1b){log['debug']('@updateInternetPlanHistory');var _0x47cff7=app[_0x68ed('0x12')][_0x68ed('0x1a')];return Q['Promise'](function(_0x56a8e6,_0x5586e9){_0x1fe9f2[_0x68ed('0x16')](_0x525d1b)[_0x68ed('0x1c')](function(_0x35ce35){if(!_0x35ce35){log[_0x68ed('0x9')]('no\x20such\x20plan');return _0x5586e9(_0x68ed('0x1e'),_0x525d1b);}_0x47cff7[_0x68ed('0x16')](_0x28294b)[_0x68ed('0x1c')](function(_0xc9fab6){if(!_0xc9fab6){log[_0x68ed('0x9')](_0x68ed('0x21'));return _0x5586e9(_0x68ed('0x21'));}var _0x472f6e=_0xc9fab6[_0x68ed('0x35')]||[];_0x1fe9f2[_0x68ed('0x2e')](_0xc9fab6['businessId'],_0x28294b,_0x472f6e[_0x68ed('0x36')]())[_0x68ed('0x1c')](_0x58680c=>{if(_0x58680c){_0x472f6e[_0x68ed('0x37')](_0x58680c);}var _0x22d677=_0x35ce35;_0x22d677[_0x68ed('0x31')]=new Date()[_0x68ed('0x2a')]();_0x472f6e[_0x68ed('0x37')](_0x22d677);if(_0x472f6e[_0x68ed('0x38')]>0x14){_0x472f6e=_0x472f6e[_0x68ed('0x39')](_0x472f6e[_0x68ed('0x38')]-0x14);}_0xc9fab6[_0x68ed('0x2c')]({'internetPlanHistory':_0x472f6e},function(_0x59a259,_0x3e52e6){if(_0x59a259){log[_0x68ed('0x9')](_0x59a259);return _0x5586e9(_0x59a259);}log[_0x68ed('0x6')](_0x68ed('0x3a'),_0x3e52e6);return _0x56a8e6();});})['fail'](_0x21b8d3=>{log['error'](_0x21b8d3);return _0x5586e9(_0x68ed('0x3b'));});});});});};_0x1fe9f2[_0x68ed('0x3c')]('assignPlanToMember',{'accepts':[{'arg':_0x68ed('0x3d'),'type':'string','required':!![]},{'arg':_0x68ed('0x3e'),'type':'string','required':!![]},{'arg':_0x68ed('0x3f'),'type':_0x68ed('0x40')},{'arg':_0x68ed('0x41'),'type':_0x68ed('0x40')}],'returns':{'root':!![]}});_0x1fe9f2[_0x68ed('0x42')]=function(_0x1bdf38,_0xa914e0,_0x3f7dde){log['debug'](_0x68ed('0x43'));_0x1fe9f2[_0x68ed('0x18')](_0x1bdf38,_0xa914e0,!![])[_0x68ed('0x1c')](function(){return _0x3f7dde(null,{'ok':!![]});})[_0x68ed('0x34')](function(_0x563601){log[_0x68ed('0x9')](_0x563601);return _0x3f7dde(_0x563601);});};_0x1fe9f2[_0x68ed('0x3c')]('assignFreePlanToMember',{'accepts':[{'arg':_0x68ed('0x3d'),'type':_0x68ed('0x44'),'required':!![]},{'arg':_0x68ed('0x3e'),'type':_0x68ed('0x44'),'required':!![]}],'returns':{'root':!![]}});_0x1fe9f2[_0x68ed('0x45')]=function(_0x479a68,_0x5b3c41){log[_0x68ed('0x6')](_0x68ed('0x46'));if(!_0x479a68){var _0x20bc11=new Error();_0x20bc11[_0x68ed('0x47')]=hotspotMessages['invalidBusinessId'];_0x20bc11[_0x68ed('0x48')]=0x194;return _0x5b3c41(_0x20bc11);}_0x1fe9f2['find']({'where':{'and':[{'businessId':_0x479a68},{'accessType':config[_0x68ed('0x49')]}]}},function(_0x4703cc,_0x5564ce){if(_0x4703cc){log[_0x68ed('0x9')](_0x4703cc);return _0x5b3c41(_0x4703cc);}return _0x5b3c41(null,_0x5564ce);});};_0x1fe9f2[_0x68ed('0x3c')]('getPublicInternetPlans',{'accepts':[{'arg':_0x68ed('0x22'),'type':'string','required':!![]}],'returns':{'root':!![]}});};