var _0x8240=['QUNDT1VOVElOR19UT1BJQw==','QHJlZnJlc2hNZXRhZGF0YSBFcnJvcjo=','UHJvZHVjZXIgcHJlcGFyYXRpb24gZmFpbGVkOg==','ZXhwb3J0cw==','Y2FsY3VsYXRlVXNhZ2U=','dXBsb2Fk','ZG93bmxvYWQ=','c2Vzc2lvblRpbWU=','Z2V0VXNhZ2U=','Z2V0QnVzaW5lc3NVc2FnZQ==','cmVtb3RlTWV0aG9k','ZGVwYXJ0bWVudElk','c3RhcnREYXRl','U3RhcnQgRGF0ZQ==','ZW5kRGF0ZQ==','b3B0aW9ucw==','b2JqZWN0','b3B0aW9uc0Zyb21SZXF1ZXN0','Z2V0RGF0YWJhc2VJbmZv','dGFibGU=','Z2V0VG9wTWVtYmVycw==','Y3VycmVudFVzZXJJZA==','cGFyc2VJbnQ=','YWxs','Z2V0VG9wTWVtYmVyc0J5VXNhZ2U=','dXNlcm5hbWU=','cHVzaA==','R2V0IFRvcCBNZW1iZXJzLg==','bnVtYmVy','cHJvbWlzZQ==','c2V0','c2Vzc2lvbklk','c3RyaW5naWZ5','ZmFpbGVkIHRvIGNhY2hlIHVzYWdl','ZmFpbGVkIHRvIGNhY2hl','Z2V0VXNhZ2VGcm9tQ2FjaGU=','Z2V0','ZmFpbGVkIHRvIGdldCB1c2FnZSBmcm9tIGNhY2hlIGJ5IGlkOiA=','cHJldmlld3Mgc2Vzc2lvbiBpcyBlbXB0eQ==','cGFyc2U=','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','bG9n','d2Fybg==','aW5mbw==','ZXhjZXB0aW9u','dHJhY2U=','ZGVidWc=','ZXJyb3I=','Li4vLi4vc2VydmVyL3NlcnZlcg==','Li4vLi4vc2VydmVyL21vZHVsZXMvdXRpbGl0eQ==','a2Fma2Etbm9kZQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmlnLmpz','Li4vLi4vc2VydmVyL21vZHVsZXMvbG9nZ2Vy','Y3JlYXRlTG9nZ2Vy','dW5kZXJzY29yZQ==','ZW52','S0FGS0FfSVA=','S0FGS0FfUE9SVA==','Li4vLi4vc2VydmVyL21vZHVsZXMvZGIuZmFjdG9yeQ==','Y3JlYXRlQ2xpZW50','UE9SVA==','UkVESVM=','SE9TVA==','cmVhZHk=','UHJvZHVjZXIgcmVhZHkuLi4=','cmVmcmVzaE1ldGFkYXRh'];(function(_0x344532,_0x2b859a){var _0xa827d6=function(_0x7fae9f){while(--_0x7fae9f){_0x344532['push'](_0x344532['shift']());}};var _0x1e1f2d=function(){var _0x388fb1={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x5ad980,_0x2f2a04,_0x20ec8a,_0x416bc9){_0x416bc9=_0x416bc9||{};var _0x12f88f=_0x2f2a04+'='+_0x20ec8a;var _0x2b8a0b=0x0;for(var _0x2b8a0b=0x0,_0x16e51e=_0x5ad980['length'];_0x2b8a0b<_0x16e51e;_0x2b8a0b++){var _0xd63748=_0x5ad980[_0x2b8a0b];_0x12f88f+=';\x20'+_0xd63748;var _0x17a6e7=_0x5ad980[_0xd63748];_0x5ad980['push'](_0x17a6e7);_0x16e51e=_0x5ad980['length'];if(_0x17a6e7!==!![]){_0x12f88f+='='+_0x17a6e7;}}_0x416bc9['cookie']=_0x12f88f;},'removeCookie':function(){return'dev';},'getCookie':function(_0x88d965,_0xc1864d){_0x88d965=_0x88d965||function(_0x5da13b){return _0x5da13b;};var _0x220f11=_0x88d965(new RegExp('(?:^|;\x20)'+_0xc1864d['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x19b529=function(_0x534272,_0x2dcb50){_0x534272(++_0x2dcb50);};_0x19b529(_0xa827d6,_0x2b859a);return _0x220f11?decodeURIComponent(_0x220f11[0x1]):undefined;}};var _0xbd11b2=function(){var _0x4d2b31=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x4d2b31['test'](_0x388fb1['removeCookie']['toString']());};_0x388fb1['updateCookie']=_0xbd11b2;var _0x3fb0b0='';var _0x121d6d=_0x388fb1['updateCookie']();if(!_0x121d6d){_0x388fb1['setCookie'](['*'],'counter',0x1);}else if(_0x121d6d){_0x3fb0b0=_0x388fb1['getCookie'](null,'counter');}else{_0x388fb1['removeCookie']();}};_0x1e1f2d();}(_0x8240,0x181));var _0x0824=function(_0x3e339e,_0x1ec56b){_0x3e339e=_0x3e339e-0x0;var _0x4504e8=_0x8240[_0x3e339e];if(_0x0824['initialized']===undefined){(function(){var _0x521bbb;try{var _0x3dcce1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x521bbb=_0x3dcce1();}catch(_0x5d8b25){_0x521bbb=window;}var _0x58335a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x521bbb['atob']||(_0x521bbb['atob']=function(_0x18534c){var _0x4fc899=String(_0x18534c)['replace'](/=+$/,'');for(var _0x548458=0x0,_0x5b0307,_0x25afca,_0x37cbb1=0x0,_0x203a8b='';_0x25afca=_0x4fc899['charAt'](_0x37cbb1++);~_0x25afca&&(_0x5b0307=_0x548458%0x4?_0x5b0307*0x40+_0x25afca:_0x25afca,_0x548458++%0x4)?_0x203a8b+=String['fromCharCode'](0xff&_0x5b0307>>(-0x2*_0x548458&0x6)):0x0){_0x25afca=_0x58335a['indexOf'](_0x25afca);}return _0x203a8b;});}());_0x0824['base64DecodeUnicode']=function(_0x3f2bdc){var _0x3cbc42=atob(_0x3f2bdc);var _0x9c5e5c=[];for(var _0x2c1ea8=0x0,_0x6a9042=_0x3cbc42['length'];_0x2c1ea8<_0x6a9042;_0x2c1ea8++){_0x9c5e5c+='%'+('00'+_0x3cbc42['charCodeAt'](_0x2c1ea8)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x9c5e5c);};_0x0824['data']={};_0x0824['initialized']=!![];}var _0x3a070a=_0x0824['data'][_0x3e339e];if(_0x3a070a===undefined){var _0x2265fb=function(_0x425d6b){this['rc4Bytes']=_0x425d6b;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2265fb['prototype']['checkState']=function(){var _0x2bd113=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x2bd113['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x2265fb['prototype']['runState']=function(_0x788745){if(!Boolean(~_0x788745)){return _0x788745;}return this['getState'](this['rc4Bytes']);};_0x2265fb['prototype']['getState']=function(_0x37e8d1){for(var _0x264211=0x0,_0x45e5d7=this['states']['length'];_0x264211<_0x45e5d7;_0x264211++){this['states']['push'](Math['round'](Math['random']()));_0x45e5d7=this['states']['length'];}return _0x37e8d1(this['states'][0x0]);};new _0x2265fb(_0x0824)['checkState']();_0x4504e8=_0x0824['base64DecodeUnicode'](_0x4504e8);_0x0824['data'][_0x3e339e]=_0x4504e8;}else{_0x4504e8=_0x3a070a;}return _0x4504e8;};var _0x279040=function(){var _0x4c6033=!![];return function(_0x26eab6,_0x94d0ab){var _0x1ea042=_0x4c6033?function(){if(_0x94d0ab){var _0xf5fc26=_0x94d0ab['apply'](_0x26eab6,arguments);_0x94d0ab=null;return _0xf5fc26;}}:function(){};_0x4c6033=![];return _0x1ea042;};}();var _0x9a7f2b=_0x279040(this,function(){var _0x1af979=function(){return'\x64\x65\x76';},_0xb13052=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x370c89=function(){var _0x120df5=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x120df5['\x74\x65\x73\x74'](_0x1af979['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x28a439=function(){var _0x120ce0=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x120ce0['\x74\x65\x73\x74'](_0xb13052['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x422ba5=function(_0x3441ef){var _0x585f45=~-0x1>>0x1+0xff%0x0;if(_0x3441ef['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x585f45)){_0x3963d3(_0x3441ef);}};var _0x3963d3=function(_0xb2f997){var _0xbbefb9=~-0x4>>0x1+0xff%0x0;if(_0xb2f997['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0xbbefb9){_0x422ba5(_0xb2f997);}};if(!_0x370c89()){if(!_0x28a439()){_0x422ba5('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x422ba5('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x422ba5('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x9a7f2b();var _0x295259=function(){var _0x1ea5c9=!![];return function(_0xf66d94,_0x1cbf55){var _0x1c8ba0=_0x1ea5c9?function(){if(_0x1cbf55){var _0x4eaab2=_0x1cbf55[_0x0824('0x0')](_0xf66d94,arguments);_0x1cbf55=null;return _0x4eaab2;}}:function(){};_0x1ea5c9=![];return _0x1c8ba0;};}();var _0x44c414=_0x295259(this,function(){var _0x5f1461=function(){};var _0x11983f;try{var _0x2f4786=Function(_0x0824('0x1')+_0x0824('0x2')+');');_0x11983f=_0x2f4786();}catch(_0x4f8023){_0x11983f=window;}if(!_0x11983f[_0x0824('0x3')]){_0x11983f[_0x0824('0x3')]=function(_0x214cb4){var _0x449a98={};_0x449a98[_0x0824('0x4')]=_0x214cb4;_0x449a98[_0x0824('0x5')]=_0x214cb4;_0x449a98['debug']=_0x214cb4;_0x449a98[_0x0824('0x6')]=_0x214cb4;_0x449a98['error']=_0x214cb4;_0x449a98[_0x0824('0x7')]=_0x214cb4;_0x449a98[_0x0824('0x8')]=_0x214cb4;return _0x449a98;}(_0x5f1461);}else{_0x11983f[_0x0824('0x3')]['log']=_0x5f1461;_0x11983f[_0x0824('0x3')][_0x0824('0x5')]=_0x5f1461;_0x11983f[_0x0824('0x3')][_0x0824('0x9')]=_0x5f1461;_0x11983f[_0x0824('0x3')][_0x0824('0x6')]=_0x5f1461;_0x11983f[_0x0824('0x3')][_0x0824('0xa')]=_0x5f1461;_0x11983f[_0x0824('0x3')][_0x0824('0x7')]=_0x5f1461;_0x11983f[_0x0824('0x3')]['trace']=_0x5f1461;}});_0x44c414();'use strict';var app=require(_0x0824('0xb'));var utility=require(_0x0824('0xc'));var Q=require('q');var kafka=require(_0x0824('0xd'));var config=require(_0x0824('0xe'));var logger=require(_0x0824('0xf'));var log=logger[_0x0824('0x10')]();var _=require(_0x0824('0x11'));var kafkaClient=new kafka['KafkaClient']({'kafkaHost':process[_0x0824('0x12')][_0x0824('0x13')]+':'+process['env'][_0x0824('0x14')]});const db=require(_0x0824('0x15'));var kafkaProducer=new kafka['Producer'](kafkaClient,{'partitionerType':0x2});var redis=require('redis');var redisClient=redis[_0x0824('0x16')](config['REDIS'][_0x0824('0x17')],config[_0x0824('0x18')][_0x0824('0x19')]);kafkaProducer['on'](_0x0824('0x1a'),function(){log[_0x0824('0x5')](_0x0824('0x1b'));kafkaClient[_0x0824('0x1c')]([config[_0x0824('0x1d')]],function(_0x29f56a){log[_0x0824('0x9')](_0x0824('0x1e'),_0x29f56a);});});kafkaProducer['on'](_0x0824('0xa'),function(_0x5f1e9a){log[_0x0824('0xa')](_0x0824('0x1f'),_0x5f1e9a);});module[_0x0824('0x20')]=function(_0x5d8609){_0x5d8609[_0x0824('0x21')]=async(_0x230581,_0x1e80b7)=>{let {upload,download,sessionTime}=_0x1e80b7;const _0x4dc49a=await _0x5d8609['getUsageFromCache'](_0x230581);if(_0x4dc49a){upload=upload-_0x4dc49a[_0x0824('0x22')];download=download-_0x4dc49a[_0x0824('0x23')];sessionTime=sessionTime-_0x4dc49a[_0x0824('0x24')];}return{'upload':upload,'download':download,'sessionTime':sessionTime};};_0x5d8609[_0x0824('0x25')]=async(_0xcb3efd,_0x3d310c,_0x2781a4,_0x2a2e51)=>{var _0x395677=_0x2a2e51['currentUserId'];if(!_0xcb3efd){return{'bulk':0x0,'download':0x0,'upload':0x0,'sessionTime':0x0};}if(_0xcb3efd==='all'){_0xcb3efd=null;}const _0xf26b5a=await db[_0x0824('0x26')](_0x395677,_0xcb3efd,_0x3d310c,_0x2781a4);return _0xf26b5a;};_0x5d8609[_0x0824('0x27')](_0x0824('0x25'),{'description':'Get\x20usage\x20report.','accepts':[{'arg':'departmentId','type':'string','description':_0x0824('0x28')},{'arg':_0x0824('0x29'),'type':'number','required':!![],'description':_0x0824('0x2a')},{'arg':_0x0824('0x2b'),'type':'number','required':!![],'description':'End\x20Date'},{'arg':_0x0824('0x2c'),'type':_0x0824('0x2d'),'http':_0x0824('0x2e')}],'returns':{'root':!![]}});_0x5d8609['reportStatus']=async()=>{const _0x55f58d=await db[_0x0824('0x2f')]();const _0x42fe0f={};for(const _0x539968 of _0x55f58d){_0x42fe0f[_0x539968[_0x0824('0x30')]]=_0x539968;}return{'db':_0x42fe0f};};_0x5d8609[_0x0824('0x27')]('reportStatus',{'description':'Get\x20report.','accepts':[],'returns':{'root':!![]}});_0x5d8609[_0x0824('0x31')]=async(_0x2107e5,_0x3e5388,_0x2fd549,_0x910d26)=>{var _0x34c7fc=_0x910d26[_0x0824('0x32')];var _0x13c635=Number[_0x0824('0x33')](_0x3e5388);var _0x4ea08d=Number[_0x0824('0x33')](_0x2fd549);const _0x5f75e=0xa;const _0x4c499f=0x0;const _0x3c9b4e=[];const _0x14a555=[];const _0x56343c=[];const _0x512632=[];if(!_0x2107e5){return{'username':_0x3c9b4e,'upload':_0x14a555,'download':_0x56343c,'sessionTime':_0x512632};}if(_0x2107e5===_0x0824('0x34')){_0x2107e5=null;}const _0x12d908=await db[_0x0824('0x35')](_0x34c7fc,_0x2107e5,_0x13c635,_0x4ea08d,_0x5f75e,_0x4c499f);for(const _0xd41a12 of _0x12d908){_0x3c9b4e['push'](_0xd41a12[_0x0824('0x36')]);_0x14a555[_0x0824('0x37')](Number(_0xd41a12['upload']));_0x56343c[_0x0824('0x37')](Number(_0xd41a12[_0x0824('0x23')]));_0x512632[_0x0824('0x37')](Number(_0xd41a12[_0x0824('0x24')]));}return{'username':_0x3c9b4e,'upload':_0x14a555,'download':_0x56343c,'sessionTime':_0x512632};};_0x5d8609[_0x0824('0x27')](_0x0824('0x31'),{'description':_0x0824('0x38'),'accepts':[{'arg':_0x0824('0x28'),'type':'string','description':_0x0824('0x28')},{'arg':_0x0824('0x29'),'type':_0x0824('0x39'),'required':!![],'description':_0x0824('0x2a')},{'arg':_0x0824('0x2b'),'type':_0x0824('0x39'),'required':!![],'description':'End\x20Date'},{'arg':_0x0824('0x2c'),'type':'object','http':_0x0824('0x2e')}],'returns':{'root':!![]}});_0x5d8609['cacheUsage']=function(_0x45e39c){return Q[_0x0824('0x3a')]((_0x199d17,_0x5578d5)=>{redisClient[_0x0824('0x3b')](_0x45e39c[_0x0824('0x3c')],JSON[_0x0824('0x3d')](_0x45e39c),'EX',0xe10,function(_0x35e192){if(_0x35e192){log[_0x0824('0xa')](_0x0824('0x3e'),_0x35e192);return _0x5578d5(_0x0824('0x3f'));}return _0x199d17();});});};_0x5d8609[_0x0824('0x40')]=function(_0x54d264){return Q['promise']((_0x487d10,_0x2370b3)=>{redisClient[_0x0824('0x41')](_0x54d264,(_0xa27a52,_0x2380a1)=>{if(_0xa27a52){log[_0x0824('0xa')](_0x0824('0x42')+_0x54d264);return _0x2370b3(_0xa27a52);}if(!_0x2380a1){log['warn'](_0x0824('0x43'));return _0x487d10();}return _0x487d10(JSON[_0x0824('0x44')](_0x2380a1));});});};};