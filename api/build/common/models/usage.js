var _0xd0a8=['ZmFpbGVkIHRvIGNhY2hlIHVzYWdl','ZmFpbGVkIHRvIGNhY2hl','cHJvbWlzZQ==','Z2V0','ZmFpbGVkIHRvIGdldCB1c2FnZSBmcm9tIGNhY2hlIGJ5IGlkOiA=','cHJldmlld3Mgc2Vzc2lvbiBpcyBlbXB0eQ==','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','d2Fybg==','ZGVidWc=','aW5mbw==','ZXJyb3I=','ZXhjZXB0aW9u','dHJhY2U=','Li4vLi4vc2VydmVyL21vZHVsZXMvdXRpbGl0eQ==','a2Fma2Etbm9kZQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmlnLmpz','Li4vLi4vc2VydmVyL21vZHVsZXMvbG9nZ2Vy','Y3JlYXRlTG9nZ2Vy','dW5kZXJzY29yZQ==','ZW52','S0FGS0FfSVA=','S0FGS0FfUE9SVA==','Li4vLi4vc2VydmVyL21vZHVsZXMvZGIuZmFjdG9yeQ==','UHJvZHVjZXI=','cmVkaXM=','UkVESVM=','UE9SVA==','SE9TVA==','UHJvZHVjZXIgcmVhZHkuLi4=','cmVmcmVzaE1ldGFkYXRh','QHJlZnJlc2hNZXRhZGF0YSBFcnJvcjo=','UHJvZHVjZXIgcHJlcGFyYXRpb24gZmFpbGVkOg==','Z2V0VXNhZ2VGcm9tQ2FjaGU=','c2Vzc2lvblRpbWU=','Y3VycmVudFVzZXJJZA==','Z2V0QnVzaW5lc3NVc2FnZQ==','Z2V0VXNhZ2U=','R2V0IHVzYWdlIHJlcG9ydC4=','ZGVwYXJ0bWVudElk','c3RyaW5n','c3RhcnREYXRl','bnVtYmVy','U3RhcnQgRGF0ZQ==','ZW5kRGF0ZQ==','RW5kIERhdGU=','b3B0aW9ucw==','b3B0aW9uc0Zyb21SZXF1ZXN0','Z2V0RGF0YWJhc2VJbmZv','dGFibGU=','cmVtb3RlTWV0aG9k','cmVwb3J0U3RhdHVz','Z2V0VG9wTWVtYmVycw==','cGFyc2VJbnQ=','YWxs','Z2V0VG9wTWVtYmVyc0J5VXNhZ2U=','cHVzaA==','dXNlcm5hbWU=','dXBsb2Fk','ZG93bmxvYWQ=','R2V0IFRvcCBNZW1iZXJzLg==','b2JqZWN0','c2V0','c2Vzc2lvbklk','c3RyaW5naWZ5'];(function(_0x241424,_0x25eb5d){var _0x3da798=function(_0x415153){while(--_0x415153){_0x241424['push'](_0x241424['shift']());}};var _0x128797=function(){var _0x438753={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x51d674,_0x5dd7a7,_0x47093e,_0x4e215d){_0x4e215d=_0x4e215d||{};var _0x5939ff=_0x5dd7a7+'='+_0x47093e;var _0x2d9162=0x0;for(var _0x2d9162=0x0,_0x41c7c8=_0x51d674['length'];_0x2d9162<_0x41c7c8;_0x2d9162++){var _0x1c2cfd=_0x51d674[_0x2d9162];_0x5939ff+=';\x20'+_0x1c2cfd;var _0x180502=_0x51d674[_0x1c2cfd];_0x51d674['push'](_0x180502);_0x41c7c8=_0x51d674['length'];if(_0x180502!==!![]){_0x5939ff+='='+_0x180502;}}_0x4e215d['cookie']=_0x5939ff;},'removeCookie':function(){return'dev';},'getCookie':function(_0x217972,_0x3c8020){_0x217972=_0x217972||function(_0x126ba7){return _0x126ba7;};var _0x3d9f0f=_0x217972(new RegExp('(?:^|;\x20)'+_0x3c8020['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x196ebd=function(_0x252b9d,_0x9f993){_0x252b9d(++_0x9f993);};_0x196ebd(_0x3da798,_0x25eb5d);return _0x3d9f0f?decodeURIComponent(_0x3d9f0f[0x1]):undefined;}};var _0x11e203=function(){var _0xdda3e6=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0xdda3e6['test'](_0x438753['removeCookie']['toString']());};_0x438753['updateCookie']=_0x11e203;var _0x5e8efb='';var _0x44ff0c=_0x438753['updateCookie']();if(!_0x44ff0c){_0x438753['setCookie'](['*'],'counter',0x1);}else if(_0x44ff0c){_0x5e8efb=_0x438753['getCookie'](null,'counter');}else{_0x438753['removeCookie']();}};_0x128797();}(_0xd0a8,0x155));var _0x8d0a=function(_0x331a90,_0x1abb6c){_0x331a90=_0x331a90-0x0;var _0x4a075d=_0xd0a8[_0x331a90];if(_0x8d0a['initialized']===undefined){(function(){var _0x1bb6f5;try{var _0x39ad5e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1bb6f5=_0x39ad5e();}catch(_0xb556bd){_0x1bb6f5=window;}var _0x2b62dc='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x1bb6f5['atob']||(_0x1bb6f5['atob']=function(_0x71d0a0){var _0x4e948e=String(_0x71d0a0)['replace'](/=+$/,'');for(var _0x21a2fd=0x0,_0x57450f,_0x25537a,_0x52b45b=0x0,_0x2ebbed='';_0x25537a=_0x4e948e['charAt'](_0x52b45b++);~_0x25537a&&(_0x57450f=_0x21a2fd%0x4?_0x57450f*0x40+_0x25537a:_0x25537a,_0x21a2fd++%0x4)?_0x2ebbed+=String['fromCharCode'](0xff&_0x57450f>>(-0x2*_0x21a2fd&0x6)):0x0){_0x25537a=_0x2b62dc['indexOf'](_0x25537a);}return _0x2ebbed;});}());_0x8d0a['base64DecodeUnicode']=function(_0x4761fb){var _0x21fb67=atob(_0x4761fb);var _0x283cba=[];for(var _0x35888d=0x0,_0x506c0b=_0x21fb67['length'];_0x35888d<_0x506c0b;_0x35888d++){_0x283cba+='%'+('00'+_0x21fb67['charCodeAt'](_0x35888d)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x283cba);};_0x8d0a['data']={};_0x8d0a['initialized']=!![];}var _0x2fa933=_0x8d0a['data'][_0x331a90];if(_0x2fa933===undefined){var _0x1df90e=function(_0x2d6612){this['rc4Bytes']=_0x2d6612;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x1df90e['prototype']['checkState']=function(){var _0x1c97c0=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x1c97c0['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x1df90e['prototype']['runState']=function(_0x2fef9e){if(!Boolean(~_0x2fef9e)){return _0x2fef9e;}return this['getState'](this['rc4Bytes']);};_0x1df90e['prototype']['getState']=function(_0x4fc58e){for(var _0x3bede1=0x0,_0x26e41c=this['states']['length'];_0x3bede1<_0x26e41c;_0x3bede1++){this['states']['push'](Math['round'](Math['random']()));_0x26e41c=this['states']['length'];}return _0x4fc58e(this['states'][0x0]);};new _0x1df90e(_0x8d0a)['checkState']();_0x4a075d=_0x8d0a['base64DecodeUnicode'](_0x4a075d);_0x8d0a['data'][_0x331a90]=_0x4a075d;}else{_0x4a075d=_0x2fa933;}return _0x4a075d;};var _0x11cf33=function(){var _0x81b58f=!![];return function(_0x35028e,_0x5ab425){var _0x45dcf2=_0x81b58f?function(){if(_0x5ab425){var _0x4b8abf=_0x5ab425['apply'](_0x35028e,arguments);_0x5ab425=null;return _0x4b8abf;}}:function(){};_0x81b58f=![];return _0x45dcf2;};}();var _0x44fb40=_0x11cf33(this,function(){var _0x5f55b0=function(){return'\x64\x65\x76';},_0x311f75=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x3b9559=function(){var _0x247ab5=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x247ab5['\x74\x65\x73\x74'](_0x5f55b0['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x2c3a4c=function(){var _0x159bb9=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x159bb9['\x74\x65\x73\x74'](_0x311f75['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x4c3a13=function(_0x151808){var _0x2a20c6=~-0x1>>0x1+0xff%0x0;if(_0x151808['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x2a20c6)){_0xd70906(_0x151808);}};var _0xd70906=function(_0xc661da){var _0x5f53bc=~-0x4>>0x1+0xff%0x0;if(_0xc661da['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x5f53bc){_0x4c3a13(_0xc661da);}};if(!_0x3b9559()){if(!_0x2c3a4c()){_0x4c3a13('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x4c3a13('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x4c3a13('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x44fb40();var _0x4a762a=function(){var _0x5796ca=!![];return function(_0x4992f1,_0x37dca1){var _0x3062a9=_0x5796ca?function(){if(_0x37dca1){var _0x5b4a29=_0x37dca1[_0x8d0a('0x0')](_0x4992f1,arguments);_0x37dca1=null;return _0x5b4a29;}}:function(){};_0x5796ca=![];return _0x3062a9;};}();var _0x1828ec=_0x4a762a(this,function(){var _0x2e4dfd=function(){};var _0x114eb4;try{var _0x4dc6a4=Function(_0x8d0a('0x1')+_0x8d0a('0x2')+');');_0x114eb4=_0x4dc6a4();}catch(_0x1a5849){_0x114eb4=window;}if(!_0x114eb4[_0x8d0a('0x3')]){_0x114eb4[_0x8d0a('0x3')]=function(_0x1e9bc6){var _0x55cee7={};_0x55cee7['log']=_0x1e9bc6;_0x55cee7[_0x8d0a('0x4')]=_0x1e9bc6;_0x55cee7[_0x8d0a('0x5')]=_0x1e9bc6;_0x55cee7[_0x8d0a('0x6')]=_0x1e9bc6;_0x55cee7[_0x8d0a('0x7')]=_0x1e9bc6;_0x55cee7['exception']=_0x1e9bc6;_0x55cee7['trace']=_0x1e9bc6;return _0x55cee7;}(_0x2e4dfd);}else{_0x114eb4[_0x8d0a('0x3')]['log']=_0x2e4dfd;_0x114eb4[_0x8d0a('0x3')][_0x8d0a('0x4')]=_0x2e4dfd;_0x114eb4['console'][_0x8d0a('0x5')]=_0x2e4dfd;_0x114eb4[_0x8d0a('0x3')]['info']=_0x2e4dfd;_0x114eb4['console'][_0x8d0a('0x7')]=_0x2e4dfd;_0x114eb4[_0x8d0a('0x3')][_0x8d0a('0x8')]=_0x2e4dfd;_0x114eb4[_0x8d0a('0x3')][_0x8d0a('0x9')]=_0x2e4dfd;}});_0x1828ec();'use strict';var app=require('../../server/server');var utility=require(_0x8d0a('0xa'));var Q=require('q');var kafka=require(_0x8d0a('0xb'));var config=require(_0x8d0a('0xc'));var logger=require(_0x8d0a('0xd'));var log=logger[_0x8d0a('0xe')]();var _=require(_0x8d0a('0xf'));var kafkaClient=new kafka['KafkaClient']({'kafkaHost':process[_0x8d0a('0x10')][_0x8d0a('0x11')]+':'+process[_0x8d0a('0x10')][_0x8d0a('0x12')]});const db=require(_0x8d0a('0x13'));var kafkaProducer=new kafka[(_0x8d0a('0x14'))](kafkaClient,{'partitionerType':0x2});var redis=require(_0x8d0a('0x15'));var redisClient=redis['createClient'](config[_0x8d0a('0x16')][_0x8d0a('0x17')],config[_0x8d0a('0x16')][_0x8d0a('0x18')]);kafkaProducer['on']('ready',function(){log[_0x8d0a('0x4')](_0x8d0a('0x19'));kafkaClient[_0x8d0a('0x1a')]([config['ACCOUNTING_TOPIC']],function(_0x390dd6){log['debug'](_0x8d0a('0x1b'),_0x390dd6);});});kafkaProducer['on'](_0x8d0a('0x7'),function(_0x382a1a){log[_0x8d0a('0x7')](_0x8d0a('0x1c'),_0x382a1a);});module['exports']=function(_0x3663aa){_0x3663aa['calculateUsage']=async(_0x2fbda8,_0xb221c5)=>{let {upload,download,sessionTime}=_0xb221c5;const _0x8b4359=await _0x3663aa[_0x8d0a('0x1d')](_0x2fbda8);if(_0x8b4359){upload=upload-_0x8b4359['upload'];download=download-_0x8b4359['download'];sessionTime=sessionTime-_0x8b4359[_0x8d0a('0x1e')];}return{'upload':upload,'download':download,'sessionTime':sessionTime};};_0x3663aa['getUsage']=async(_0x2c03f7,_0x3f11e0,_0x39e2c5,_0x1e6526)=>{var _0x5228fd=_0x1e6526[_0x8d0a('0x1f')];if(!_0x2c03f7){return{'bulk':0x0,'download':0x0,'upload':0x0,'sessionTime':0x0};}if(_0x2c03f7==='all'){_0x2c03f7=null;}const _0x25bd4c=await db[_0x8d0a('0x20')](_0x5228fd,_0x2c03f7,_0x3f11e0,_0x39e2c5);return _0x25bd4c;};_0x3663aa['remoteMethod'](_0x8d0a('0x21'),{'description':_0x8d0a('0x22'),'accepts':[{'arg':_0x8d0a('0x23'),'type':_0x8d0a('0x24'),'description':_0x8d0a('0x23')},{'arg':_0x8d0a('0x25'),'type':_0x8d0a('0x26'),'required':!![],'description':_0x8d0a('0x27')},{'arg':_0x8d0a('0x28'),'type':'number','required':!![],'description':_0x8d0a('0x29')},{'arg':_0x8d0a('0x2a'),'type':'object','http':_0x8d0a('0x2b')}],'returns':{'root':!![]}});_0x3663aa['reportStatus']=async()=>{const _0x5872bb=await db[_0x8d0a('0x2c')]();const _0x10ad5f={};for(const _0xdf3a2e of _0x5872bb){_0x10ad5f[_0xdf3a2e[_0x8d0a('0x2d')]]=_0xdf3a2e;}return{'db':_0x10ad5f};};_0x3663aa[_0x8d0a('0x2e')](_0x8d0a('0x2f'),{'description':'Get\x20report.','accepts':[],'returns':{'root':!![]}});_0x3663aa[_0x8d0a('0x30')]=async(_0x3673ef,_0x536211,_0xf62b8f,_0x53e4c9)=>{var _0x972152=_0x53e4c9[_0x8d0a('0x1f')];var _0x410d44=Number[_0x8d0a('0x31')](_0x536211);var _0x398954=Number['parseInt'](_0xf62b8f);const _0x4b76e0=0xa;const _0x43f99f=0x0;const _0x5e43b6=[];const _0x49debd=[];const _0x2f6f99=[];const _0x20951f=[];if(!_0x3673ef){return{'username':_0x5e43b6,'upload':_0x49debd,'download':_0x2f6f99,'sessionTime':_0x20951f};}if(_0x3673ef===_0x8d0a('0x32')){_0x3673ef=null;}const _0x5acd2e=await db[_0x8d0a('0x33')](_0x972152,_0x3673ef,_0x410d44,_0x398954,_0x4b76e0,_0x43f99f);for(const _0x49164a of _0x5acd2e){_0x5e43b6[_0x8d0a('0x34')](_0x49164a[_0x8d0a('0x35')]);_0x49debd[_0x8d0a('0x34')](Number(_0x49164a[_0x8d0a('0x36')]));_0x2f6f99['push'](Number(_0x49164a[_0x8d0a('0x37')]));_0x20951f['push'](Number(_0x49164a['sessionTime']));}return{'username':_0x5e43b6,'upload':_0x49debd,'download':_0x2f6f99,'sessionTime':_0x20951f};};_0x3663aa['remoteMethod'](_0x8d0a('0x30'),{'description':_0x8d0a('0x38'),'accepts':[{'arg':_0x8d0a('0x23'),'type':_0x8d0a('0x24'),'description':'departmentId'},{'arg':'startDate','type':'number','required':!![],'description':_0x8d0a('0x27')},{'arg':_0x8d0a('0x28'),'type':_0x8d0a('0x26'),'required':!![],'description':'End\x20Date'},{'arg':_0x8d0a('0x2a'),'type':_0x8d0a('0x39'),'http':_0x8d0a('0x2b')}],'returns':{'root':!![]}});_0x3663aa['cacheUsage']=function(_0x399386){return Q['promise']((_0x18a7ba,_0xd56df2)=>{redisClient[_0x8d0a('0x3a')](_0x399386[_0x8d0a('0x3b')],JSON[_0x8d0a('0x3c')](_0x399386),'EX',0xe10,function(_0x119443){if(_0x119443){log[_0x8d0a('0x7')](_0x8d0a('0x3d'),_0x119443);return _0xd56df2(_0x8d0a('0x3e'));}return _0x18a7ba();});});};_0x3663aa['getUsageFromCache']=function(_0x1fa95f){return Q[_0x8d0a('0x3f')]((_0x11a7c9,_0x4ac584)=>{redisClient[_0x8d0a('0x40')](_0x1fa95f,(_0x265ad4,_0x13992f)=>{if(_0x265ad4){log[_0x8d0a('0x7')](_0x8d0a('0x41')+_0x1fa95f);return _0x4ac584(_0x265ad4);}if(!_0x13992f){log[_0x8d0a('0x4')](_0x8d0a('0x42'));return _0x11a7c9();}return _0x11a7c9(JSON['parse'](_0x13992f));});});};};