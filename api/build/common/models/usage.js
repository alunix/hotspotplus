var _0xa706=['e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','bG9n','d2Fybg==','ZGVidWc=','aW5mbw==','ZXJyb3I=','Y29uc29sZQ==','ZXhjZXB0aW9u','dHJhY2U=','Li4vLi4vc2VydmVyL21vZHVsZXMvdXRpbGl0eQ==','a2Fma2Etbm9kZQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmlnLmpz','Li4vLi4vc2VydmVyL21vZHVsZXMvbG9nZ2Vy','Y3JlYXRlTG9nZ2Vy','dW5kZXJzY29yZQ==','S2Fma2FDbGllbnQ=','ZW52','S0FGS0FfSVA=','Li4vLi4vc2VydmVyL21vZHVsZXMvZGIuZmFjdG9yeQ==','UHJvZHVjZXI=','Y3JlYXRlQ2xpZW50','UkVESVM=','UE9SVA==','SE9TVA==','cmVhZHk=','UHJvZHVjZXIgcmVhZHkuLi4=','cmVmcmVzaE1ldGFkYXRh','QHJlZnJlc2hNZXRhZGF0YSBFcnJvcjo=','UHJvZHVjZXIgcHJlcGFyYXRpb24gZmFpbGVkOg==','Z2V0VXNhZ2VGcm9tQ2FjaGU=','dXBsb2Fk','ZG93bmxvYWQ=','c2Vzc2lvblRpbWU=','Z2V0VXNhZ2U=','Y3VycmVudFVzZXJJZA==','Z2V0QnVzaW5lc3NVc2FnZQ==','ZGVwYXJ0bWVudElk','c3RhcnREYXRl','ZW5kRGF0ZQ==','bnVtYmVy','RW5kIERhdGU=','b3B0aW9ucw==','b2JqZWN0','cmVwb3J0U3RhdHVz','Z2V0RGF0YWJhc2VJbmZv','dGFibGU=','cmVtb3RlTWV0aG9k','R2V0IHJlcG9ydC4=','cGFyc2VJbnQ=','YWxs','cHVzaA==','Z2V0VG9wTWVtYmVycw==','c3RyaW5n','cHJvbWlzZQ==','c2V0','c2Vzc2lvbklk','ZmFpbGVkIHRvIGNhY2hlIHVzYWdl','ZmFpbGVkIHRvIGNhY2hl','Z2V0','cHJldmlld3Mgc2Vzc2lvbiBpcyBlbXB0eQ==','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA=='];(function(_0x4c70c4,_0x963969){var _0x437865=function(_0x54e323){while(--_0x54e323){_0x4c70c4['push'](_0x4c70c4['shift']());}};var _0x3ebf07=function(){var _0x342923={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x5e2a79,_0x2aa9f6,_0x44ebb1,_0x27c1c8){_0x27c1c8=_0x27c1c8||{};var _0xe4dc8b=_0x2aa9f6+'='+_0x44ebb1;var _0x20b75b=0x0;for(var _0x20b75b=0x0,_0x45b5ab=_0x5e2a79['length'];_0x20b75b<_0x45b5ab;_0x20b75b++){var _0x510a88=_0x5e2a79[_0x20b75b];_0xe4dc8b+=';\x20'+_0x510a88;var _0x36b549=_0x5e2a79[_0x510a88];_0x5e2a79['push'](_0x36b549);_0x45b5ab=_0x5e2a79['length'];if(_0x36b549!==!![]){_0xe4dc8b+='='+_0x36b549;}}_0x27c1c8['cookie']=_0xe4dc8b;},'removeCookie':function(){return'dev';},'getCookie':function(_0x6cc83b,_0x4fee16){_0x6cc83b=_0x6cc83b||function(_0x34a5e3){return _0x34a5e3;};var _0x2c1b36=_0x6cc83b(new RegExp('(?:^|;\x20)'+_0x4fee16['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x5ec404=function(_0x5737c3,_0x4b32f8){_0x5737c3(++_0x4b32f8);};_0x5ec404(_0x437865,_0x963969);return _0x2c1b36?decodeURIComponent(_0x2c1b36[0x1]):undefined;}};var _0x2962d5=function(){var _0x341424=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x341424['test'](_0x342923['removeCookie']['toString']());};_0x342923['updateCookie']=_0x2962d5;var _0x309039='';var _0x5f00b8=_0x342923['updateCookie']();if(!_0x5f00b8){_0x342923['setCookie'](['*'],'counter',0x1);}else if(_0x5f00b8){_0x309039=_0x342923['getCookie'](null,'counter');}else{_0x342923['removeCookie']();}};_0x3ebf07();}(_0xa706,0x7a));var _0x6a70=function(_0xd25e8c,_0x444318){_0xd25e8c=_0xd25e8c-0x0;var _0x2181e0=_0xa706[_0xd25e8c];if(_0x6a70['initialized']===undefined){(function(){var _0x479022;try{var _0x5e71f4=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x479022=_0x5e71f4();}catch(_0x262aaf){_0x479022=window;}var _0x23ef0e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x479022['atob']||(_0x479022['atob']=function(_0x5cc824){var _0x480e2c=String(_0x5cc824)['replace'](/=+$/,'');for(var _0x11a153=0x0,_0x388519,_0x277c03,_0x49d9b4=0x0,_0xeb25a6='';_0x277c03=_0x480e2c['charAt'](_0x49d9b4++);~_0x277c03&&(_0x388519=_0x11a153%0x4?_0x388519*0x40+_0x277c03:_0x277c03,_0x11a153++%0x4)?_0xeb25a6+=String['fromCharCode'](0xff&_0x388519>>(-0x2*_0x11a153&0x6)):0x0){_0x277c03=_0x23ef0e['indexOf'](_0x277c03);}return _0xeb25a6;});}());_0x6a70['base64DecodeUnicode']=function(_0x523423){var _0xf57b03=atob(_0x523423);var _0x289840=[];for(var _0x48ae98=0x0,_0x274237=_0xf57b03['length'];_0x48ae98<_0x274237;_0x48ae98++){_0x289840+='%'+('00'+_0xf57b03['charCodeAt'](_0x48ae98)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x289840);};_0x6a70['data']={};_0x6a70['initialized']=!![];}var _0x2a76a7=_0x6a70['data'][_0xd25e8c];if(_0x2a76a7===undefined){var _0x3de56b=function(_0x5eb57f){this['rc4Bytes']=_0x5eb57f;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3de56b['prototype']['checkState']=function(){var _0x3aba3c=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x3aba3c['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x3de56b['prototype']['runState']=function(_0x2fa764){if(!Boolean(~_0x2fa764)){return _0x2fa764;}return this['getState'](this['rc4Bytes']);};_0x3de56b['prototype']['getState']=function(_0x471633){for(var _0x24ce19=0x0,_0x12bb8e=this['states']['length'];_0x24ce19<_0x12bb8e;_0x24ce19++){this['states']['push'](Math['round'](Math['random']()));_0x12bb8e=this['states']['length'];}return _0x471633(this['states'][0x0]);};new _0x3de56b(_0x6a70)['checkState']();_0x2181e0=_0x6a70['base64DecodeUnicode'](_0x2181e0);_0x6a70['data'][_0xd25e8c]=_0x2181e0;}else{_0x2181e0=_0x2a76a7;}return _0x2181e0;};var _0x353eae=function(){var _0x48ba03=!![];return function(_0x7998f,_0x8063db){var _0x155cb9=_0x48ba03?function(){if(_0x8063db){var _0x2da4dd=_0x8063db['apply'](_0x7998f,arguments);_0x8063db=null;return _0x2da4dd;}}:function(){};_0x48ba03=![];return _0x155cb9;};}();var _0x4d1a42=_0x353eae(this,function(){var _0x42ee1e=function(){return'\x64\x65\x76';},_0x3f1a64=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x14eb78=function(){var _0x54c430=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x54c430['\x74\x65\x73\x74'](_0x42ee1e['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x166226=function(){var _0x32f695=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x32f695['\x74\x65\x73\x74'](_0x3f1a64['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x55da2b=function(_0x4dc9ac){var _0xa6e0fa=~-0x1>>0x1+0xff%0x0;if(_0x4dc9ac['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0xa6e0fa)){_0xbac65e(_0x4dc9ac);}};var _0xbac65e=function(_0x4578d0){var _0x291232=~-0x4>>0x1+0xff%0x0;if(_0x4578d0['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x291232){_0x55da2b(_0x4578d0);}};if(!_0x14eb78()){if(!_0x166226()){_0x55da2b('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x55da2b('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x55da2b('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x4d1a42();var _0x509996=function(){var _0x5027dc=!![];return function(_0xfda074,_0x12228f){var _0x3212e7=_0x5027dc?function(){if(_0x12228f){var _0x1795b7=_0x12228f[_0x6a70('0x0')](_0xfda074,arguments);_0x12228f=null;return _0x1795b7;}}:function(){};_0x5027dc=![];return _0x3212e7;};}();var _0x2b06e8=_0x509996(this,function(){var _0x57f6dd=function(){};var _0x25ebf7;try{var _0x187458=Function(_0x6a70('0x1')+_0x6a70('0x2')+');');_0x25ebf7=_0x187458();}catch(_0x5e3526){_0x25ebf7=window;}if(!_0x25ebf7['console']){_0x25ebf7['console']=function(_0x361a84){var _0x50457c={};_0x50457c[_0x6a70('0x3')]=_0x361a84;_0x50457c[_0x6a70('0x4')]=_0x361a84;_0x50457c[_0x6a70('0x5')]=_0x361a84;_0x50457c[_0x6a70('0x6')]=_0x361a84;_0x50457c[_0x6a70('0x7')]=_0x361a84;_0x50457c['exception']=_0x361a84;_0x50457c['trace']=_0x361a84;return _0x50457c;}(_0x57f6dd);}else{_0x25ebf7[_0x6a70('0x8')]['log']=_0x57f6dd;_0x25ebf7[_0x6a70('0x8')][_0x6a70('0x4')]=_0x57f6dd;_0x25ebf7[_0x6a70('0x8')][_0x6a70('0x5')]=_0x57f6dd;_0x25ebf7['console']['info']=_0x57f6dd;_0x25ebf7[_0x6a70('0x8')][_0x6a70('0x7')]=_0x57f6dd;_0x25ebf7[_0x6a70('0x8')][_0x6a70('0x9')]=_0x57f6dd;_0x25ebf7['console'][_0x6a70('0xa')]=_0x57f6dd;}});_0x2b06e8();'use strict';var app=require('../../server/server');var utility=require(_0x6a70('0xb'));var Q=require('q');var kafka=require(_0x6a70('0xc'));var config=require(_0x6a70('0xd'));var logger=require(_0x6a70('0xe'));var log=logger[_0x6a70('0xf')]();var _=require(_0x6a70('0x10'));var kafkaClient=new kafka[(_0x6a70('0x11'))]({'kafkaHost':process[_0x6a70('0x12')][_0x6a70('0x13')]+':'+process[_0x6a70('0x12')]['KAFKA_PORT']});const db=require(_0x6a70('0x14'));var kafkaProducer=new kafka[(_0x6a70('0x15'))](kafkaClient,{'partitionerType':0x2});var redis=require('redis');var redisClient=redis[_0x6a70('0x16')](config[_0x6a70('0x17')][_0x6a70('0x18')],config[_0x6a70('0x17')][_0x6a70('0x19')]);kafkaProducer['on'](_0x6a70('0x1a'),function(){log[_0x6a70('0x4')](_0x6a70('0x1b'));kafkaClient[_0x6a70('0x1c')]([config['ACCOUNTING_TOPIC']],function(_0x7f4c5e){log[_0x6a70('0x5')](_0x6a70('0x1d'),_0x7f4c5e);});});kafkaProducer['on'](_0x6a70('0x7'),function(_0x346b92){log[_0x6a70('0x7')](_0x6a70('0x1e'),_0x346b92);});module['exports']=function(_0x570260){_0x570260['calculateUsage']=async(_0x484bff,_0x2328d6)=>{let {upload,download,sessionTime}=_0x2328d6;const _0x37c42f=await _0x570260[_0x6a70('0x1f')](_0x484bff);if(_0x37c42f){upload=upload-_0x37c42f[_0x6a70('0x20')];download=download-_0x37c42f[_0x6a70('0x21')];sessionTime=sessionTime-_0x37c42f[_0x6a70('0x22')];}return{'upload':upload,'download':download,'sessionTime':sessionTime};};_0x570260[_0x6a70('0x23')]=async(_0x4c05e4,_0x146a08,_0xc7675e,_0x59e544)=>{var _0x4a3a72=_0x59e544[_0x6a70('0x24')];if(!_0x4c05e4){return{'bulk':0x0,'download':0x0,'upload':0x0,'sessionTime':0x0};}if(_0x4c05e4==='all'){_0x4c05e4=null;}const _0x25961f=await db[_0x6a70('0x25')](_0x4a3a72,_0x4c05e4,_0x146a08,_0xc7675e);return _0x25961f;};_0x570260['remoteMethod'](_0x6a70('0x23'),{'description':'Get\x20usage\x20report.','accepts':[{'arg':_0x6a70('0x26'),'type':'string','description':_0x6a70('0x26')},{'arg':_0x6a70('0x27'),'type':'number','required':!![],'description':'Start\x20Date'},{'arg':_0x6a70('0x28'),'type':_0x6a70('0x29'),'required':!![],'description':_0x6a70('0x2a')},{'arg':_0x6a70('0x2b'),'type':_0x6a70('0x2c'),'http':'optionsFromRequest'}],'returns':{'root':!![]}});_0x570260[_0x6a70('0x2d')]=async()=>{const _0x1e8197=await db[_0x6a70('0x2e')]();const _0x1d213c={};for(const _0x2e7933 of _0x1e8197){_0x1d213c[_0x2e7933[_0x6a70('0x2f')]]=_0x2e7933;}return{'db':_0x1d213c};};_0x570260[_0x6a70('0x30')]('reportStatus',{'description':_0x6a70('0x31'),'accepts':[],'returns':{'root':!![]}});_0x570260['getTopMembers']=async(_0x4416d9,_0x1571a0,_0x4f49af,_0x274d4b)=>{var _0x3816f7=_0x274d4b['currentUserId'];var _0x5cab51=Number[_0x6a70('0x32')](_0x1571a0);var _0x1d9758=Number[_0x6a70('0x32')](_0x4f49af);const _0x20f207=0xa;const _0x4842d7=0x0;const _0x4d187a=[];const _0x1208be=[];const _0x212023=[];const _0x1f48d5=[];if(!_0x4416d9){return{'username':_0x4d187a,'upload':_0x1208be,'download':_0x212023,'sessionTime':_0x1f48d5};}if(_0x4416d9===_0x6a70('0x33')){_0x4416d9=null;}const _0x342299=await db['getTopMembersByUsage'](_0x3816f7,_0x4416d9,_0x5cab51,_0x1d9758,_0x20f207,_0x4842d7);for(const _0xbad53c of _0x342299){_0x4d187a[_0x6a70('0x34')](_0xbad53c['username']);_0x1208be[_0x6a70('0x34')](Number(_0xbad53c[_0x6a70('0x20')]));_0x212023[_0x6a70('0x34')](Number(_0xbad53c['download']));_0x1f48d5[_0x6a70('0x34')](Number(_0xbad53c['sessionTime']));}return{'username':_0x4d187a,'upload':_0x1208be,'download':_0x212023,'sessionTime':_0x1f48d5};};_0x570260[_0x6a70('0x30')](_0x6a70('0x35'),{'description':'Get\x20Top\x20Members.','accepts':[{'arg':'departmentId','type':_0x6a70('0x36'),'description':'departmentId'},{'arg':_0x6a70('0x27'),'type':_0x6a70('0x29'),'required':!![],'description':'Start\x20Date'},{'arg':_0x6a70('0x28'),'type':_0x6a70('0x29'),'required':!![],'description':_0x6a70('0x2a')},{'arg':_0x6a70('0x2b'),'type':_0x6a70('0x2c'),'http':'optionsFromRequest'}],'returns':{'root':!![]}});_0x570260['cacheUsage']=function(_0x967828){return Q[_0x6a70('0x37')]((_0xea81b2,_0x1a90e3)=>{redisClient[_0x6a70('0x38')](_0x967828[_0x6a70('0x39')],JSON['stringify'](_0x967828),'EX',0xe10,function(_0xbd1395){if(_0xbd1395){log[_0x6a70('0x7')](_0x6a70('0x3a'),_0xbd1395);return _0x1a90e3(_0x6a70('0x3b'));}return _0xea81b2();});});};_0x570260[_0x6a70('0x1f')]=function(_0x57fa50){return Q['promise']((_0x18920a,_0x159d94)=>{redisClient[_0x6a70('0x3c')](_0x57fa50,(_0x46bf59,_0x53e887)=>{if(_0x46bf59){log[_0x6a70('0x7')]('failed\x20to\x20get\x20usage\x20from\x20cache\x20by\x20id:\x20'+_0x57fa50);return _0x159d94(_0x46bf59);}if(!_0x53e887){log[_0x6a70('0x4')](_0x6a70('0x3d'));return _0x18920a();}return _0x18920a(JSON['parse'](_0x53e887));});});};};