var _0xa63f=['dHJpbU1hYw==','bWFj','aW52YWxpZCBtYWMgYWRkcmVzcw==','cG9ydA==','bmFzIGNyZWF0ZWQgOiA=','bG9hZFJvdXRlckluZm8=','ZmluZEJ5SWQ=','dGhlbg==','bG9hZGluZyBuYXMgaWQ=','bWVzc2FnZQ==','cm91dGVyTm90Rm91bmQ=','c3RhdHVz','cmVtb3RlTWV0aG9k','TG9hZCByb3V0ZXIgaW5mbw==','bmFzSWQ=','c3RyaW5n','bG9hZFRoZW1lQ29uZmlnQnlJZA==','bW9kZWxz','VGhlbWU=','bG9hZENvbmZpZw==','YnVzaW5lc3NJZA==','c2VsZWN0ZWRUaGVtZUlk','Y29udHJvbGxlcg==','dGhlbWVDb25maWc=','dGVtcGxhdGU=','TG9hZCBsb2FkVGhlbWVDb25maWdCeUlkIA==','bG9hZFJhZGl1c0luZm8=','UkFESVVTX0lQ','UkFESVVTX0FVVEhfUE9SVA==','QnVzaW5lc3M=','cHJvbWlzZQ==','bmFzU2NyaXB0cw==','emlwSXQ=','LnppcA==','Zm9sZGVy','aG90c3BvdHBsdXM=','U0NSSVBUUw==','bG9hZEJ5SWQ=','cmVhZEZyb21DYWNoZQ==','ZnJvbSBkYi4uLg==','Y2FjaGVJdA==','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','bG9n','d2Fybg==','ZGVidWc=','ZXJyb3I=','dHJhY2U=','aW5mbw==','ZXhjZXB0aW9u','Li4vLi4vc2VydmVyL3NlcnZlcg==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmln','Li4vLi4vc2VydmVyL21vZHVsZXMvaG90c3BvdE1lc3NhZ2Vz','Li4vLi4vc2VydmVyL21vZHVsZXMvaHNwQ2FjaGU=','ZXhwb3J0cw==','dmFsaWRhdGVzVW5pcXVlbmVzc09m','bmFzSXBQb3J0S2V5','b2JzZXJ2ZQ==','bG9hZGVk','YWNjZXNzUG9pbnRUeXBl','ZGF0YQ==','YmVmb3JlIHNhdmU=','aW5zdGFuY2U=','aXNOZXdJbnN0YW5jZQ==','Y3JlYXRpb25EYXRl','dXBkYXRlRGF0ZQ==','bWF0Y2g='];(function(_0x2be8c2,_0x14a4b5){var _0x97f531=function(_0xcee58d){while(--_0xcee58d){_0x2be8c2['push'](_0x2be8c2['shift']());}};var _0x3f9e37=function(){var _0xfc7927={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x349f5f,_0x135f6f,_0x235986,_0x14cecb){_0x14cecb=_0x14cecb||{};var _0xeb31af=_0x135f6f+'='+_0x235986;var _0x5d5272=0x0;for(var _0x5d5272=0x0,_0x539a27=_0x349f5f['length'];_0x5d5272<_0x539a27;_0x5d5272++){var _0x37e48d=_0x349f5f[_0x5d5272];_0xeb31af+=';\x20'+_0x37e48d;var _0x4f563d=_0x349f5f[_0x37e48d];_0x349f5f['push'](_0x4f563d);_0x539a27=_0x349f5f['length'];if(_0x4f563d!==!![]){_0xeb31af+='='+_0x4f563d;}}_0x14cecb['cookie']=_0xeb31af;},'removeCookie':function(){return'dev';},'getCookie':function(_0x1d0019,_0x674a2a){_0x1d0019=_0x1d0019||function(_0x368e8b){return _0x368e8b;};var _0x57f930=_0x1d0019(new RegExp('(?:^|;\x20)'+_0x674a2a['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x42af11=function(_0x49d94b,_0x1f63d8){_0x49d94b(++_0x1f63d8);};_0x42af11(_0x97f531,_0x14a4b5);return _0x57f930?decodeURIComponent(_0x57f930[0x1]):undefined;}};var _0x29c93f=function(){var _0x2ec5a4=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x2ec5a4['test'](_0xfc7927['removeCookie']['toString']());};_0xfc7927['updateCookie']=_0x29c93f;var _0x32a8a2='';var _0x131627=_0xfc7927['updateCookie']();if(!_0x131627){_0xfc7927['setCookie'](['*'],'counter',0x1);}else if(_0x131627){_0x32a8a2=_0xfc7927['getCookie'](null,'counter');}else{_0xfc7927['removeCookie']();}};_0x3f9e37();}(_0xa63f,0x182));var _0xfa63=function(_0x55494f,_0x1fd483){_0x55494f=_0x55494f-0x0;var _0x2edb23=_0xa63f[_0x55494f];if(_0xfa63['initialized']===undefined){(function(){var _0x2896fb;try{var _0x4fdf31=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2896fb=_0x4fdf31();}catch(_0x45c9a0){_0x2896fb=window;}var _0x4f491e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x2896fb['atob']||(_0x2896fb['atob']=function(_0x13dd96){var _0x18fcad=String(_0x13dd96)['replace'](/=+$/,'');for(var _0x512cfa=0x0,_0x2b9c08,_0x595a13,_0x3efba6=0x0,_0x3f13a5='';_0x595a13=_0x18fcad['charAt'](_0x3efba6++);~_0x595a13&&(_0x2b9c08=_0x512cfa%0x4?_0x2b9c08*0x40+_0x595a13:_0x595a13,_0x512cfa++%0x4)?_0x3f13a5+=String['fromCharCode'](0xff&_0x2b9c08>>(-0x2*_0x512cfa&0x6)):0x0){_0x595a13=_0x4f491e['indexOf'](_0x595a13);}return _0x3f13a5;});}());_0xfa63['base64DecodeUnicode']=function(_0x4ff778){var _0x543d7a=atob(_0x4ff778);var _0x1e558b=[];for(var _0x41bc51=0x0,_0x26b5de=_0x543d7a['length'];_0x41bc51<_0x26b5de;_0x41bc51++){_0x1e558b+='%'+('00'+_0x543d7a['charCodeAt'](_0x41bc51)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1e558b);};_0xfa63['data']={};_0xfa63['initialized']=!![];}var _0x37daa2=_0xfa63['data'][_0x55494f];if(_0x37daa2===undefined){var _0x498cf9=function(_0x273fd5){this['rc4Bytes']=_0x273fd5;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x498cf9['prototype']['checkState']=function(){var _0x481475=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x481475['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x498cf9['prototype']['runState']=function(_0x13e4ba){if(!Boolean(~_0x13e4ba)){return _0x13e4ba;}return this['getState'](this['rc4Bytes']);};_0x498cf9['prototype']['getState']=function(_0x5855c2){for(var _0x4b95af=0x0,_0x278d02=this['states']['length'];_0x4b95af<_0x278d02;_0x4b95af++){this['states']['push'](Math['round'](Math['random']()));_0x278d02=this['states']['length'];}return _0x5855c2(this['states'][0x0]);};new _0x498cf9(_0xfa63)['checkState']();_0x2edb23=_0xfa63['base64DecodeUnicode'](_0x2edb23);_0xfa63['data'][_0x55494f]=_0x2edb23;}else{_0x2edb23=_0x37daa2;}return _0x2edb23;};var _0xbcbd09=function(){var _0x28e8e7=!![];return function(_0x598c5f,_0x42eb92){var _0xb27fb4=_0x28e8e7?function(){if(_0x42eb92){var _0x54dd56=_0x42eb92['apply'](_0x598c5f,arguments);_0x42eb92=null;return _0x54dd56;}}:function(){};_0x28e8e7=![];return _0xb27fb4;};}();var _0x2b0dbe=_0xbcbd09(this,function(){var _0x29ae7f=function(){return'\x64\x65\x76';},_0x37fcc4=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x4a4f9e=function(){var _0x446b06=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x446b06['\x74\x65\x73\x74'](_0x29ae7f['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0xfee8f1=function(){var _0x44c8b4=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x44c8b4['\x74\x65\x73\x74'](_0x37fcc4['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0xd0e1a7=function(_0x3c6f51){var _0x1ffcd2=~-0x1>>0x1+0xff%0x0;if(_0x3c6f51['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x1ffcd2)){_0x340cbd(_0x3c6f51);}};var _0x340cbd=function(_0x5e69b6){var _0x512056=~-0x4>>0x1+0xff%0x0;if(_0x5e69b6['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x512056){_0xd0e1a7(_0x5e69b6);}};if(!_0x4a4f9e()){if(!_0xfee8f1()){_0xd0e1a7('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0xd0e1a7('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0xd0e1a7('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x2b0dbe();var _0x508b03=function(){var _0x2226eb=!![];return function(_0x1c07bb,_0x2ec03f){var _0x27bd5b=_0x2226eb?function(){if(_0x2ec03f){var _0x231bc4=_0x2ec03f[_0xfa63('0x0')](_0x1c07bb,arguments);_0x2ec03f=null;return _0x231bc4;}}:function(){};_0x2226eb=![];return _0x27bd5b;};}();var _0xa20e63=_0x508b03(this,function(){var _0x138518=function(){};var _0x581d1f;try{var _0x5a2eca=Function(_0xfa63('0x1')+_0xfa63('0x2')+');');_0x581d1f=_0x5a2eca();}catch(_0xb35bc5){_0x581d1f=window;}if(!_0x581d1f[_0xfa63('0x3')]){_0x581d1f['console']=function(_0x505e1a){var _0x575b64={};_0x575b64[_0xfa63('0x4')]=_0x505e1a;_0x575b64[_0xfa63('0x5')]=_0x505e1a;_0x575b64[_0xfa63('0x6')]=_0x505e1a;_0x575b64['info']=_0x505e1a;_0x575b64[_0xfa63('0x7')]=_0x505e1a;_0x575b64['exception']=_0x505e1a;_0x575b64[_0xfa63('0x8')]=_0x505e1a;return _0x575b64;}(_0x138518);}else{_0x581d1f['console'][_0xfa63('0x4')]=_0x138518;_0x581d1f[_0xfa63('0x3')][_0xfa63('0x5')]=_0x138518;_0x581d1f[_0xfa63('0x3')][_0xfa63('0x6')]=_0x138518;_0x581d1f[_0xfa63('0x3')][_0xfa63('0x9')]=_0x138518;_0x581d1f[_0xfa63('0x3')]['error']=_0x138518;_0x581d1f['console'][_0xfa63('0xa')]=_0x138518;_0x581d1f[_0xfa63('0x3')][_0xfa63('0x8')]=_0x138518;}});_0xa20e63();var logger=require('../../server/modules/logger');var app=require(_0xfa63('0xb'));var utility=require('../../server/modules/utility');var config=require(_0xfa63('0xc'));var Q=require('q');var hotspotMessages=require(_0xfa63('0xd'));var hotspotTemplates=require('../../server/modules/hotspotTemplates');const hspCache=require(_0xfa63('0xe'));module[_0xfa63('0xf')]=function(_0x6d23f4){_0x6d23f4[_0xfa63('0x10')](_0xfa63('0x11'));var _0x1e1559=logger['createLogger']();_0x6d23f4[_0xfa63('0x12')](_0xfa63('0x13'),function(_0x29e345,_0xb597f2){if(_0x29e345['data']){if(_0x29e345['data'][_0xfa63('0x14')]){_0x29e345[_0xfa63('0x15')][_0xfa63('0x14')]=_0x29e345[_0xfa63('0x15')]['accessPointType']['toLowerCase']();}}_0xb597f2();});_0x6d23f4[_0xfa63('0x12')](_0xfa63('0x16'),function(_0x931bf0,_0xa83c1d){if(_0x931bf0[_0xfa63('0x17')]&&_0x931bf0[_0xfa63('0x18')]){_0x931bf0['instance'][_0xfa63('0x19')]=_0x931bf0[_0xfa63('0x17')][_0xfa63('0x1a')]=new Date();if(_0x931bf0[_0xfa63('0x17')]['mac']){if(_0x931bf0[_0xfa63('0x17')]['mac'][_0xfa63('0x1b')](/[a-z]/i)){_0x931bf0['instance']['mac']=utility[_0xfa63('0x1c')](_0x931bf0[_0xfa63('0x17')][_0xfa63('0x1d')]);_0x931bf0[_0xfa63('0x17')]['id']=_0x931bf0['instance'][_0xfa63('0x1d')];}else{return _0xa83c1d(_0xfa63('0x1e'));}}if(_0x931bf0[_0xfa63('0x17')]['ip']&&_0x931bf0[_0xfa63('0x17')]['port']){_0x931bf0[_0xfa63('0x11')]=_0x931bf0[_0xfa63('0x17')]['ip']+_0x931bf0[_0xfa63('0x17')][_0xfa63('0x1f')];}_0x1e1559['debug'](_0xfa63('0x20'),_0x931bf0[_0xfa63('0x17')]);}_0xa83c1d();});_0x6d23f4[_0xfa63('0x21')]=function(_0x315239,_0x476789){_0x6d23f4[_0xfa63('0x22')](_0x315239)[_0xfa63('0x23')](function(_0xf86c46){_0x1e1559[_0xfa63('0x6')](_0xfa63('0x24'),_0x315239);if(!_0xf86c46){var _0x5300c7=new Error();_0x5300c7[_0xfa63('0x25')]=hotspotMessages[_0xfa63('0x26')];_0x5300c7[_0xfa63('0x27')]=0x194;return _0x476789(_0x5300c7);}_0x1e1559[_0xfa63('0x6')]('loaded\x20nas\x20',_0xf86c46);return _0x476789(null,_0xf86c46);});};_0x6d23f4[_0xfa63('0x28')]('loadRouterInfo',{'description':_0xfa63('0x29'),'accepts':[{'arg':_0xfa63('0x2a'),'type':_0xfa63('0x2b'),'required':!![]}],'returns':{'root':!![]}});_0x6d23f4[_0xfa63('0x2c')]=function(_0x30f013,_0x317a2b){var _0x1c227a=app[_0xfa63('0x2d')]['Business'];var _0x1fe449=app[_0xfa63('0x2d')][_0xfa63('0x2e')];_0x6d23f4[_0xfa63('0x21')](_0x30f013,function(_0x3786e4,_0x35cb84){if(_0x3786e4){_0x1e1559[_0xfa63('0x7')](_0x3786e4);return _0x317a2b(_0x3786e4);}_0x1c227a[_0xfa63('0x2f')](_0x35cb84[_0xfa63('0x30')],function(_0x4a1507,_0x1cb680){if(_0x4a1507){_0x1e1559[_0xfa63('0x7')](_0x4a1507);return _0x317a2b(_0x4a1507);}_0x1cb680[_0xfa63('0x2a')]=_0x35cb84['id'];_0x1cb680[_0xfa63('0x14')]=_0x35cb84[_0xfa63('0x14')];_0x1cb680['businessId']=_0x35cb84[_0xfa63('0x30')];_0x1cb680['themeConfig']['controller']=hotspotTemplates[_0x1cb680[_0xfa63('0x31')]][_0xfa63('0x32')];_0x1cb680[_0xfa63('0x33')]['template']=hotspotTemplates[_0x1cb680[_0xfa63('0x31')]][_0xfa63('0x34')];return _0x317a2b(null,_0x1cb680);});});};_0x6d23f4[_0xfa63('0x28')](_0xfa63('0x2c'),{'description':_0xfa63('0x35'),'accepts':[{'arg':'nasId','type':_0xfa63('0x2b'),'required':!![]}],'returns':{'root':!![]}});_0x6d23f4[_0xfa63('0x36')]=function(_0x170915){return _0x170915(null,{'radiusIp':config[_0xfa63('0x37')],'secondRadiusIp':config['SECOND_RADIUS_IP'],'accountingPort':config['RADIUS_ACC_PORT'],'authenticationPort':config[_0xfa63('0x38')]});};_0x6d23f4['remoteMethod'](_0xfa63('0x36'),{'description':_0xfa63('0x29'),'accepts':[],'returns':{'root':!![]}});_0x6d23f4['getMikrotikScripts']=function(_0xe31336,_0x3b40e6){var _0x43a0ce=app[_0xfa63('0x2d')][_0xfa63('0x39')];return Q[_0xfa63('0x3a')](function(_0x20a264,_0x9a6ff4){var _0x2fb27c=_0xfa63('0x3b');utility[_0xfa63('0x3c')](_0x2fb27c+_0xfa63('0x3d'),[{'type':_0xfa63('0x3e'),'name':_0xfa63('0x3f'),'files':config[_0xfa63('0x40')]['MIKROTIK_HOTSPOT_PAGES']}])['then'](function(_0x1506a3){_0x1e1559[_0xfa63('0x6')](_0x1506a3);return _0x20a264(_0x1506a3);})['fail'](function(_0x49a0ca){_0x1e1559['error'](_0x49a0ca);return _0x9a6ff4(_0x49a0ca);});});};_0x6d23f4['getNasCredential']=function(){return config['PRIMARY_SHARED_SECRET'];};_0x6d23f4[_0xfa63('0x41')]=async _0x394cb9=>{const _0x14ed20=await hspCache[_0xfa63('0x42')](_0x394cb9);if(_0x14ed20){return _0x14ed20;}const _0x2b8fd3=await _0x6d23f4[_0xfa63('0x22')](_0x394cb9);_0x1e1559[_0xfa63('0x5')](_0xfa63('0x43'),_0x2b8fd3);hspCache[_0xfa63('0x44')](_0x394cb9,_0x2b8fd3);return _0x2b8fd3;};};