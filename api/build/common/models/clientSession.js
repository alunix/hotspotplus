var _0x4157=['ZGVwYXJ0bWVudElk','ZGVwYXJ0bWVudA==','bmFzSXA=','Z2V0QXR0cmlidXRl','ZnJhbWVkSXBBZGRyZXNz','Y3JlYXRpb25EYXRl','dXRj','dGltZXN0YW1w','dW5peA==','dXNlcm5hbWU=','YWNjU3RhdHVzVHlwZQ==','YWNjdFN0YXR1c1R5cGU=','bWFj','ZG93bmxvYWQ=','dXBsb2Fk','c2Vzc2lvblRpbWU=','Z3JvdXBJZGVudGl0eUlk','bW9kZWxz','VXNhZ2U=','Y2FjaGVVc2FnZQ==','c2VuZFRvQnJva2Vy','cHJvbWlzZQ==','c2VuZA==','c3RyaW5naWZ5','RmFpbGVkIHRvIGFkZCBzZXNzaW9uIHRvIGthZmthOiA=','c2Vzc2lvbiBhZGRlZDo=','Z2V0T25saW5lVXNlcnM=','cmVtb3Zl','YWRk','YWxs','Z2V0QWN0aXZlU2Vzc2lvbklkcw==','Z2V0U2Vzc2lvblVzYWdl','cHVzaA==','Z2V0QWN0aXZlTWVtYmVyU2Vzc2lvbnM=','Z2V0TWVtYmVyU2Vzc2lvbnM=','cmVtb3RlTWV0aG9k','c3RhcnREYXRl','bnVtYmVy','ZW5kRGF0ZQ==','c3RyaW5n','c2tpcA==','bGltaXQ=','cmVzdWx0','QGdldE9ubGluZVNlc3Npb25Db3VudCA6IA==','Y291bnRTZXNzaW9ucw==','Y291bnQ=','ZmFpbGVkIHRvIGdldCBvbmxpbmUgc2Vzc2lvbiBjb3VudA==','Z2V0T25saW5lU2Vzc2lvbkNvdW50','R2V0IE9ubGluZSBTZXNzaW9ucyBDb3VudC4=','Z2V0U2Vzc2lvbnNCeUlk','c2VuZFBvZA==','a2lsbE9ubGluZVNlc3Npb24=','S2lsbCBPbmxpbmUgU2Vzc2lvbg==','b2JqZWN0','b3B0aW9ucw==','b3B0aW9uc0Zyb21SZXF1ZXN0','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','d2Fybg==','ZGVidWc=','ZXJyb3I=','ZXhjZXB0aW9u','dHJhY2U=','bG9n','Li4vLi4vc2VydmVyL3NlcnZlcg==','Y3JlYXRlTG9nZ2Vy','Li4vLi4vc2VydmVyL21vZHVsZXMvcmFkaXVzRGlzY29ubmVjdFNlcnZpY2U=','a2Fma2Etbm9kZQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmln','Li4vLi4vc2VydmVyL21vZHVsZXMvZGIuZmFjdG9yeQ==','bW9tZW50','dW5kZXJzY29yZQ==','S0FGS0FfSVA=','ZW52','S0FGS0FfUE9SVA==','UHJvZHVjZXI=','cmVhZHk=','UHJvZHVjZXIgcmVhZHkuLi4=','cmVmcmVzaE1ldGFkYXRh','U0VTU0lPTl9UT1BJQw==','QHJlZnJlc2hNZXRhZGF0YSBFcnJvcjo=','UHJvZHVjZXIgcHJlcGFyYXRpb24gZmFpbGVkOg==','c2V0U2Vzc2lvbg==','Z2V0U2Vzc2lvbklk','c2Vzc2lvbklk','bWVtYmVySWQ=','YnVzaW5lc3NJZA=='];(function(_0x1da7b,_0x3ce5ec){var _0x4bf8e3=function(_0x21bed2){while(--_0x21bed2){_0x1da7b['push'](_0x1da7b['shift']());}};var _0x439a13=function(){var _0x3b8101={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x31bf54,_0x2558ad,_0x33aa1d,_0x16722b){_0x16722b=_0x16722b||{};var _0x208010=_0x2558ad+'='+_0x33aa1d;var _0x30be0a=0x0;for(var _0x30be0a=0x0,_0x34b135=_0x31bf54['length'];_0x30be0a<_0x34b135;_0x30be0a++){var _0x1ce7c2=_0x31bf54[_0x30be0a];_0x208010+=';\x20'+_0x1ce7c2;var _0xc93418=_0x31bf54[_0x1ce7c2];_0x31bf54['push'](_0xc93418);_0x34b135=_0x31bf54['length'];if(_0xc93418!==!![]){_0x208010+='='+_0xc93418;}}_0x16722b['cookie']=_0x208010;},'removeCookie':function(){return'dev';},'getCookie':function(_0x3b906e,_0x4c6773){_0x3b906e=_0x3b906e||function(_0x59be22){return _0x59be22;};var _0x10200b=_0x3b906e(new RegExp('(?:^|;\x20)'+_0x4c6773['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x1bc711=function(_0x145c63,_0x3f9ae4){_0x145c63(++_0x3f9ae4);};_0x1bc711(_0x4bf8e3,_0x3ce5ec);return _0x10200b?decodeURIComponent(_0x10200b[0x1]):undefined;}};var _0x521f10=function(){var _0x47f1fa=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x47f1fa['test'](_0x3b8101['removeCookie']['toString']());};_0x3b8101['updateCookie']=_0x521f10;var _0x4eb57='';var _0x35cec0=_0x3b8101['updateCookie']();if(!_0x35cec0){_0x3b8101['setCookie'](['*'],'counter',0x1);}else if(_0x35cec0){_0x4eb57=_0x3b8101['getCookie'](null,'counter');}else{_0x3b8101['removeCookie']();}};_0x439a13();}(_0x4157,0x91));var _0x7415=function(_0x1aaa97,_0x5a9010){_0x1aaa97=_0x1aaa97-0x0;var _0x177b56=_0x4157[_0x1aaa97];if(_0x7415['initialized']===undefined){(function(){var _0x429b62;try{var _0x48202e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x429b62=_0x48202e();}catch(_0x3a95a6){_0x429b62=window;}var _0x329694='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x429b62['atob']||(_0x429b62['atob']=function(_0x292c0e){var _0x48bf5e=String(_0x292c0e)['replace'](/=+$/,'');for(var _0x31305b=0x0,_0x20414f,_0x205b37,_0x35a225=0x0,_0x31297b='';_0x205b37=_0x48bf5e['charAt'](_0x35a225++);~_0x205b37&&(_0x20414f=_0x31305b%0x4?_0x20414f*0x40+_0x205b37:_0x205b37,_0x31305b++%0x4)?_0x31297b+=String['fromCharCode'](0xff&_0x20414f>>(-0x2*_0x31305b&0x6)):0x0){_0x205b37=_0x329694['indexOf'](_0x205b37);}return _0x31297b;});}());_0x7415['base64DecodeUnicode']=function(_0x42809f){var _0x50be5d=atob(_0x42809f);var _0x3b1611=[];for(var _0x49f216=0x0,_0xbc9fb7=_0x50be5d['length'];_0x49f216<_0xbc9fb7;_0x49f216++){_0x3b1611+='%'+('00'+_0x50be5d['charCodeAt'](_0x49f216)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3b1611);};_0x7415['data']={};_0x7415['initialized']=!![];}var _0x482710=_0x7415['data'][_0x1aaa97];if(_0x482710===undefined){var _0x40ea30=function(_0x32a7e7){this['rc4Bytes']=_0x32a7e7;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x40ea30['prototype']['checkState']=function(){var _0x31902b=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x31902b['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x40ea30['prototype']['runState']=function(_0x3613b6){if(!Boolean(~_0x3613b6)){return _0x3613b6;}return this['getState'](this['rc4Bytes']);};_0x40ea30['prototype']['getState']=function(_0x4bd9c7){for(var _0x29a762=0x0,_0x3df5ed=this['states']['length'];_0x29a762<_0x3df5ed;_0x29a762++){this['states']['push'](Math['round'](Math['random']()));_0x3df5ed=this['states']['length'];}return _0x4bd9c7(this['states'][0x0]);};new _0x40ea30(_0x7415)['checkState']();_0x177b56=_0x7415['base64DecodeUnicode'](_0x177b56);_0x7415['data'][_0x1aaa97]=_0x177b56;}else{_0x177b56=_0x482710;}return _0x177b56;};var _0x931b98=function(){var _0x1fc991=!![];return function(_0x24a7fd,_0x2e2342){var _0x471bae=_0x1fc991?function(){if(_0x2e2342){var _0x175d7f=_0x2e2342['apply'](_0x24a7fd,arguments);_0x2e2342=null;return _0x175d7f;}}:function(){};_0x1fc991=![];return _0x471bae;};}();var _0x5624a6=_0x931b98(this,function(){var _0x180032=function(){return'\x64\x65\x76';},_0x33e01b=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x4af0f8=function(){var _0x5bfc29=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x5bfc29['\x74\x65\x73\x74'](_0x180032['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x4ece4f=function(){var _0x5e552c=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x5e552c['\x74\x65\x73\x74'](_0x33e01b['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x1bc911=function(_0x5ae4d1){var _0x5781b8=~-0x1>>0x1+0xff%0x0;if(_0x5ae4d1['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x5781b8)){_0x2b8414(_0x5ae4d1);}};var _0x2b8414=function(_0x3f865a){var _0x3e4ead=~-0x4>>0x1+0xff%0x0;if(_0x3f865a['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x3e4ead){_0x1bc911(_0x3f865a);}};if(!_0x4af0f8()){if(!_0x4ece4f()){_0x1bc911('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x1bc911('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x1bc911('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x5624a6();var _0x358f0d=function(){var _0x1ba3cb=!![];return function(_0x3f8de7,_0x41ef91){var _0x2e22d4=_0x1ba3cb?function(){if(_0x41ef91){var _0x5cc4cc=_0x41ef91[_0x7415('0x0')](_0x3f8de7,arguments);_0x41ef91=null;return _0x5cc4cc;}}:function(){};_0x1ba3cb=![];return _0x2e22d4;};}();var _0x44eb9e=_0x358f0d(this,function(){var _0x7f97f4=function(){};var _0x2c3e06;try{var _0x2b3874=Function(_0x7415('0x1')+_0x7415('0x2')+');');_0x2c3e06=_0x2b3874();}catch(_0x21542f){_0x2c3e06=window;}if(!_0x2c3e06[_0x7415('0x3')]){_0x2c3e06[_0x7415('0x3')]=function(_0x84f5b6){var _0x52f85c={};_0x52f85c['log']=_0x84f5b6;_0x52f85c[_0x7415('0x4')]=_0x84f5b6;_0x52f85c[_0x7415('0x5')]=_0x84f5b6;_0x52f85c['info']=_0x84f5b6;_0x52f85c[_0x7415('0x6')]=_0x84f5b6;_0x52f85c[_0x7415('0x7')]=_0x84f5b6;_0x52f85c[_0x7415('0x8')]=_0x84f5b6;return _0x52f85c;}(_0x7f97f4);}else{_0x2c3e06['console'][_0x7415('0x9')]=_0x7f97f4;_0x2c3e06[_0x7415('0x3')][_0x7415('0x4')]=_0x7f97f4;_0x2c3e06['console']['debug']=_0x7f97f4;_0x2c3e06[_0x7415('0x3')]['info']=_0x7f97f4;_0x2c3e06[_0x7415('0x3')]['error']=_0x7f97f4;_0x2c3e06[_0x7415('0x3')][_0x7415('0x7')]=_0x7f97f4;_0x2c3e06[_0x7415('0x3')][_0x7415('0x8')]=_0x7f97f4;}});_0x44eb9e();'use strict';var logger=require('../../server/modules/logger');var app=require(_0x7415('0xa'));var log=logger[_0x7415('0xb')]();var Q=require('q');var radiusPod=require(_0x7415('0xc'));var kafka=require(_0x7415('0xd'));var config=require(_0x7415('0xe'));const db=require(_0x7415('0xf'));const moment=require(_0x7415('0x10'));var _=require(_0x7415('0x11'));const kafkaClient=new kafka['KafkaClient']({'kafkaHost':process['env'][_0x7415('0x12')]+':'+process[_0x7415('0x13')][_0x7415('0x14')]});const kafkaProducer=new kafka[(_0x7415('0x15'))](kafkaClient,{'partitionerType':0x2});kafkaProducer['on'](_0x7415('0x16'),function(){log[_0x7415('0x4')](_0x7415('0x17'));kafkaClient[_0x7415('0x18')]([config[_0x7415('0x19')]],function(_0x5689bf){log['debug'](_0x7415('0x1a'),_0x5689bf);});});kafkaProducer['on'](_0x7415('0x6'),function(_0x249f30){log[_0x7415('0x6')](_0x7415('0x1b'),_0x249f30);});module['exports']=function(_0x50aad4){_0x50aad4[_0x7415('0x1c')]=async _0x56f902=>{const {RadiusAccountingMessage,member,nas}=_0x56f902;const _0x4f43e2=RadiusAccountingMessage[_0x7415('0x1d')]();let _0x5dec2e={};_0x5dec2e[_0x7415('0x1e')]=_0x4f43e2;_0x5dec2e[_0x7415('0x1f')]=member['id'];_0x5dec2e[_0x7415('0x20')]=nas[_0x7415('0x20')];_0x5dec2e['nasId']=nas['id'];_0x5dec2e[_0x7415('0x21')]=nas[_0x7415('0x22')];_0x5dec2e[_0x7415('0x23')]=RadiusAccountingMessage['getNasIp']();_0x5dec2e['framedIpAddress']=RadiusAccountingMessage[_0x7415('0x24')](_0x7415('0x25'));_0x5dec2e[_0x7415('0x26')]=moment[_0x7415('0x27')](RadiusAccountingMessage[_0x7415('0x24')](_0x7415('0x28')))[_0x7415('0x29')]();_0x5dec2e['username']=RadiusAccountingMessage['getAttribute'](_0x7415('0x2a'));_0x5dec2e[_0x7415('0x2b')]=RadiusAccountingMessage[_0x7415('0x24')](_0x7415('0x2c'));_0x5dec2e['sessionId']=RadiusAccountingMessage[_0x7415('0x24')]('sessionId');_0x5dec2e[_0x7415('0x2d')]=RadiusAccountingMessage[_0x7415('0x24')](_0x7415('0x2d'));_0x5dec2e['download']=RadiusAccountingMessage[_0x7415('0x24')](_0x7415('0x2e'))||0x0;_0x5dec2e[_0x7415('0x2f')]=RadiusAccountingMessage['getAttribute'](_0x7415('0x2f'))||0x0;_0x5dec2e['sessionTime']=!_['isUndefined'](RadiusAccountingMessage[_0x7415('0x24')]('sessionTime'))?RadiusAccountingMessage[_0x7415('0x24')](_0x7415('0x30')):0x0;_0x5dec2e[_0x7415('0x31')]=member[_0x7415('0x31')];var _0x4a068c=app[_0x7415('0x32')][_0x7415('0x33')];const _0x2c36a1=await _0x4a068c['calculateUsage'](_0x4f43e2,{'download':_0x5dec2e[_0x7415('0x2e')],'upload':_0x5dec2e[_0x7415('0x2f')],'sessionTime':_0x5dec2e[_0x7415('0x30')]});await _0x4a068c[_0x7415('0x34')](_0x5dec2e);_0x5dec2e[_0x7415('0x2e')]=_0x2c36a1[_0x7415('0x2e')];_0x5dec2e[_0x7415('0x2f')]=_0x2c36a1[_0x7415('0x2f')];_0x5dec2e[_0x7415('0x30')]=_0x2c36a1[_0x7415('0x30')];log[_0x7415('0x5')](_0x5dec2e);await _0x50aad4[_0x7415('0x35')](_0x5dec2e);};_0x50aad4[_0x7415('0x35')]=async _0x35bade=>{return Q[_0x7415('0x36')]((_0x130942,_0x4066a4)=>{kafkaProducer[_0x7415('0x37')]([{'topic':config['SESSION_TOPIC'],'messages':JSON[_0x7415('0x38')](_0x35bade)}],function(_0x4803e3,_0x5da1e0){if(_0x4803e3){log[_0x7415('0x6')](_0x7415('0x39'),_0x4803e3);return _0x4066a4(_0x4803e3);}log['debug'](_0x7415('0x3a'),JSON[_0x7415('0x38')](_0x35bade),_0x5da1e0);return _0x130942();});});};_0x50aad4[_0x7415('0x3b')]=async(_0x25ac4b,_0x4a43cc,_0x352b03,_0x404f6e,_0x356b9f,_0xdc8408,_0x20e2b1)=>{if(_0x356b9f==null){_0x356b9f=0x0;}if(_0xdc8408==null){_0xdc8408=0xa;}_0x25ac4b=_0x25ac4b?_0x25ac4b:new Date()[_0x7415('0x3c')]({'minutes':0x2});_0x4a43cc=_0x4a43cc?_0x4a43cc:new Date()[_0x7415('0x3d')]({'minutes':0x2});const _0x372c3d=[];if(!_0x404f6e){return _0x372c3d;}if(_0x404f6e===_0x7415('0x3e')){_0x404f6e=null;}const _0x2eedeb=await db[_0x7415('0x3f')](_0x352b03,_0x404f6e,_0x25ac4b,_0x4a43cc,_0x356b9f,_0xdc8408);for(const _0x467e22 of _0x2eedeb){const _0x5af1c4=await db[_0x7415('0x40')](_0x467e22[_0x7415('0x1e')]);_0x372c3d[_0x7415('0x41')](_0x5af1c4);}return _0x372c3d;};_0x50aad4[_0x7415('0x42')]=async(_0x520ac8,_0x304d12,_0xee9bd3)=>{_0x304d12=_0x304d12?_0x304d12:new Date()['remove']({'minutes':0x2});_0xee9bd3=_0xee9bd3?_0xee9bd3:new Date()[_0x7415('0x3d')]({'minutes':0x2});return db[_0x7415('0x43')](_0x520ac8,_0x304d12,_0xee9bd3);};_0x50aad4[_0x7415('0x44')](_0x7415('0x3b'),{'description':'Get\x20Online\x20Users\x20Report.','accepts':[{'arg':_0x7415('0x45'),'type':_0x7415('0x46')},{'arg':_0x7415('0x47'),'type':'number'},{'arg':_0x7415('0x20'),'type':_0x7415('0x48'),'required':!![]},{'arg':'departmentId','type':'string'},{'arg':_0x7415('0x49'),'type':'number','required':![]},{'arg':_0x7415('0x4a'),'type':'number','required':![]}],'returns':{'arg':_0x7415('0x4b'),'type':'Object'}});_0x50aad4['getOnlineSessionCount']=async(_0x8ece65,_0x182b0c,_0x269333,_0x4ce98f)=>{try{log['debug'](_0x7415('0x4c'),_0x8ece65);if(!_0x182b0c){return{'count':0x0};}if(_0x182b0c===_0x7415('0x3e')){_0x182b0c=null;}_0x269333=_0x269333?_0x269333:new Date()[_0x7415('0x3c')]({'minutes':0x2});_0x4ce98f=_0x4ce98f?_0x4ce98f:new Date()[_0x7415('0x3d')]({'minutes':0x2});const _0x581d18=await db[_0x7415('0x4d')](_0x8ece65,_0x182b0c,_0x269333,_0x4ce98f);return{'count':_0x581d18[_0x7415('0x4e')]};}catch(_0x311624){log[_0x7415('0x6')](_0x311624);throw new Error(_0x7415('0x4f'));}};_0x50aad4[_0x7415('0x44')](_0x7415('0x50'),{'description':_0x7415('0x51'),'accepts':[{'arg':_0x7415('0x20'),'type':'string','required':!![]},{'arg':'departmentId','type':'string'},{'arg':_0x7415('0x45'),'type':_0x7415('0x46')},{'arg':_0x7415('0x47'),'type':_0x7415('0x46')}],'returns':{'root':!![]}});_0x50aad4['killOnlineSession']=async _0x5811ba=>{log['debug']('@killOnlineSession\x20:\x20',_0x5811ba);if(!_0x5811ba['memberId']){return cb('memberId\x20is\x20not\x20defined');}var _0x200322=_0x5811ba[_0x7415('0x1e')];const _0x527e63=await db[_0x7415('0x52')](_0x200322);radiusPod[_0x7415('0x53')](_0x527e63);return{'ok':!![],'killedSession':_0x527e63};};_0x50aad4['remoteMethod'](_0x7415('0x54'),{'description':_0x7415('0x55'),'accepts':[{'arg':'session','type':_0x7415('0x56'),'required':!![]},{'arg':_0x7415('0x57'),'type':_0x7415('0x56'),'http':_0x7415('0x58')}],'returns':{'root':!![]}});};