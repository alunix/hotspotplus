var _0x8868=['S2lsbCBPbmxpbmUgU2Vzc2lvbg==','c2Vzc2lvbg==','b2JqZWN0','b3B0aW9ucw==','b3B0aW9uc0Zyb21SZXF1ZXN0','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','bG9n','d2Fybg==','aW5mbw==','ZXJyb3I=','dHJhY2U=','ZGVidWc=','ZXhjZXB0aW9u','Li4vLi4vc2VydmVyL21vZHVsZXMvbG9nZ2Vy','Li4vLi4vc2VydmVyL3NlcnZlcg==','Y3JlYXRlTG9nZ2Vy','a2Fma2Etbm9kZQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmln','bW9tZW50','dW5kZXJzY29yZQ==','S2Fma2FDbGllbnQ=','ZW52','S0FGS0FfSVA=','S0FGS0FfUE9SVA==','UHJvZHVjZXI=','UHJvZHVjZXIgcmVhZHkuLi4=','cmVmcmVzaE1ldGFkYXRh','U0VTU0lPTl9UT1BJQw==','QHJlZnJlc2hNZXRhZGF0YSBFcnJvcjo=','UHJvZHVjZXIgcHJlcGFyYXRpb24gZmFpbGVkOg==','ZXhwb3J0cw==','bWVtYmVySWQ=','YnVzaW5lc3NJZA==','bmFzSWQ=','ZGVwYXJ0bWVudElk','bmFzSXA=','Z2V0TmFzSXA=','Z2V0QXR0cmlidXRl','ZnJhbWVkSXBBZGRyZXNz','Y3JlYXRpb25EYXRl','dXRj','dGltZXN0YW1w','dW5peA==','dXNlcm5hbWU=','YWNjU3RhdHVzVHlwZQ==','c2Vzc2lvbklk','bWFj','ZG93bmxvYWQ=','dXBsb2Fk','c2Vzc2lvblRpbWU=','aXNVbmRlZmluZWQ=','Z3JvdXBJZGVudGl0eUlk','bW9kZWxz','VXNhZ2U=','Y2FsY3VsYXRlVXNhZ2U=','Y2FjaGVVc2FnZQ==','c2VuZFRvQnJva2Vy','cHJvbWlzZQ==','c2VuZA==','RmFpbGVkIHRvIGFkZCBzZXNzaW9uIHRvIGthZmthOiA=','Z2V0T25saW5lVXNlcnM=','cmVtb3Zl','YWRk','Z2V0U2Vzc2lvblVzYWdl','Z2V0TWVtYmVyU2Vzc2lvbnM=','cmVtb3RlTWV0aG9k','R2V0IE9ubGluZSBVc2VycyBSZXBvcnQu','bnVtYmVy','ZW5kRGF0ZQ==','c3RyaW5n','Z2V0T25saW5lU2Vzc2lvbkNvdW50','YWxs','Y291bnQ=','R2V0IE9ubGluZSBTZXNzaW9ucyBDb3VudC4=','c3RhcnREYXRl','a2lsbE9ubGluZVNlc3Npb24=','QGtpbGxPbmxpbmVTZXNzaW9uIDog','Z2V0U2Vzc2lvbnNCeUlk'];(function(_0x368fb9,_0x1a9895){var _0x4892fb=function(_0x28d735){while(--_0x28d735){_0x368fb9['push'](_0x368fb9['shift']());}};var _0x9c4aab=function(){var _0x1ebbfb={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x1da39b,_0x408343,_0x2b1aaf,_0x32f4e1){_0x32f4e1=_0x32f4e1||{};var _0x5123a3=_0x408343+'='+_0x2b1aaf;var _0x2ac57f=0x0;for(var _0x2ac57f=0x0,_0x4bac92=_0x1da39b['length'];_0x2ac57f<_0x4bac92;_0x2ac57f++){var _0x3d09aa=_0x1da39b[_0x2ac57f];_0x5123a3+=';\x20'+_0x3d09aa;var _0xeecce5=_0x1da39b[_0x3d09aa];_0x1da39b['push'](_0xeecce5);_0x4bac92=_0x1da39b['length'];if(_0xeecce5!==!![]){_0x5123a3+='='+_0xeecce5;}}_0x32f4e1['cookie']=_0x5123a3;},'removeCookie':function(){return'dev';},'getCookie':function(_0x352958,_0xbf270c){_0x352958=_0x352958||function(_0x328d5f){return _0x328d5f;};var _0x2e422d=_0x352958(new RegExp('(?:^|;\x20)'+_0xbf270c['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0xf420ec=function(_0x54fb06,_0x37bcd5){_0x54fb06(++_0x37bcd5);};_0xf420ec(_0x4892fb,_0x1a9895);return _0x2e422d?decodeURIComponent(_0x2e422d[0x1]):undefined;}};var _0x28de66=function(){var _0x49380c=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x49380c['test'](_0x1ebbfb['removeCookie']['toString']());};_0x1ebbfb['updateCookie']=_0x28de66;var _0x5ca0da='';var _0x44d88e=_0x1ebbfb['updateCookie']();if(!_0x44d88e){_0x1ebbfb['setCookie'](['*'],'counter',0x1);}else if(_0x44d88e){_0x5ca0da=_0x1ebbfb['getCookie'](null,'counter');}else{_0x1ebbfb['removeCookie']();}};_0x9c4aab();}(_0x8868,0xf8));var _0x8886=function(_0x6f010e,_0x410252){_0x6f010e=_0x6f010e-0x0;var _0x39b019=_0x8868[_0x6f010e];if(_0x8886['initialized']===undefined){(function(){var _0x39f3e2;try{var _0x5b8471=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x39f3e2=_0x5b8471();}catch(_0x50d680){_0x39f3e2=window;}var _0x3de2e4='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x39f3e2['atob']||(_0x39f3e2['atob']=function(_0x15308f){var _0x51a517=String(_0x15308f)['replace'](/=+$/,'');for(var _0x404d3a=0x0,_0x4352af,_0x40d070,_0x59c112=0x0,_0x5b5356='';_0x40d070=_0x51a517['charAt'](_0x59c112++);~_0x40d070&&(_0x4352af=_0x404d3a%0x4?_0x4352af*0x40+_0x40d070:_0x40d070,_0x404d3a++%0x4)?_0x5b5356+=String['fromCharCode'](0xff&_0x4352af>>(-0x2*_0x404d3a&0x6)):0x0){_0x40d070=_0x3de2e4['indexOf'](_0x40d070);}return _0x5b5356;});}());_0x8886['base64DecodeUnicode']=function(_0xb16697){var _0x2d2d3f=atob(_0xb16697);var _0x28d915=[];for(var _0x3b008f=0x0,_0x177476=_0x2d2d3f['length'];_0x3b008f<_0x177476;_0x3b008f++){_0x28d915+='%'+('00'+_0x2d2d3f['charCodeAt'](_0x3b008f)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x28d915);};_0x8886['data']={};_0x8886['initialized']=!![];}var _0x10bd3b=_0x8886['data'][_0x6f010e];if(_0x10bd3b===undefined){var _0x5b09d0=function(_0x1e11a1){this['rc4Bytes']=_0x1e11a1;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x5b09d0['prototype']['checkState']=function(){var _0x2f5c18=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x2f5c18['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x5b09d0['prototype']['runState']=function(_0x474d84){if(!Boolean(~_0x474d84)){return _0x474d84;}return this['getState'](this['rc4Bytes']);};_0x5b09d0['prototype']['getState']=function(_0xf29b96){for(var _0x230956=0x0,_0x2e117c=this['states']['length'];_0x230956<_0x2e117c;_0x230956++){this['states']['push'](Math['round'](Math['random']()));_0x2e117c=this['states']['length'];}return _0xf29b96(this['states'][0x0]);};new _0x5b09d0(_0x8886)['checkState']();_0x39b019=_0x8886['base64DecodeUnicode'](_0x39b019);_0x8886['data'][_0x6f010e]=_0x39b019;}else{_0x39b019=_0x10bd3b;}return _0x39b019;};var _0x27f0b3=function(){var _0x3e44fa=!![];return function(_0x75ed2a,_0x2a0aba){var _0x1db6a7=_0x3e44fa?function(){if(_0x2a0aba){var _0x4c9589=_0x2a0aba['apply'](_0x75ed2a,arguments);_0x2a0aba=null;return _0x4c9589;}}:function(){};_0x3e44fa=![];return _0x1db6a7;};}();var _0x44d864=_0x27f0b3(this,function(){var _0x30dc32=function(){return'\x64\x65\x76';},_0x444167=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x5c1c8b=function(){var _0x599cfe=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x599cfe['\x74\x65\x73\x74'](_0x30dc32['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x3d689b=function(){var _0xa1e11f=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0xa1e11f['\x74\x65\x73\x74'](_0x444167['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x3949f8=function(_0xe7a159){var _0x4b7025=~-0x1>>0x1+0xff%0x0;if(_0xe7a159['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x4b7025)){_0x634ab(_0xe7a159);}};var _0x634ab=function(_0x51e48a){var _0x486ac6=~-0x4>>0x1+0xff%0x0;if(_0x51e48a['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x486ac6){_0x3949f8(_0x51e48a);}};if(!_0x5c1c8b()){if(!_0x3d689b()){_0x3949f8('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x3949f8('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x3949f8('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x44d864();var _0x2f8404=function(){var _0x1cb1c8=!![];return function(_0x17b370,_0x3ca5bd){var _0x530ac5=_0x1cb1c8?function(){if(_0x3ca5bd){var _0x21a46c=_0x3ca5bd[_0x8886('0x0')](_0x17b370,arguments);_0x3ca5bd=null;return _0x21a46c;}}:function(){};_0x1cb1c8=![];return _0x530ac5;};}();var _0x45ad5f=_0x2f8404(this,function(){var _0x8639d1=function(){};var _0x28396d;try{var _0xcce86f=Function(_0x8886('0x1')+_0x8886('0x2')+');');_0x28396d=_0xcce86f();}catch(_0x292862){_0x28396d=window;}if(!_0x28396d[_0x8886('0x3')]){_0x28396d['console']=function(_0xe11a29){var _0x3bd86b={};_0x3bd86b[_0x8886('0x4')]=_0xe11a29;_0x3bd86b[_0x8886('0x5')]=_0xe11a29;_0x3bd86b['debug']=_0xe11a29;_0x3bd86b[_0x8886('0x6')]=_0xe11a29;_0x3bd86b[_0x8886('0x7')]=_0xe11a29;_0x3bd86b['exception']=_0xe11a29;_0x3bd86b[_0x8886('0x8')]=_0xe11a29;return _0x3bd86b;}(_0x8639d1);}else{_0x28396d[_0x8886('0x3')][_0x8886('0x4')]=_0x8639d1;_0x28396d[_0x8886('0x3')][_0x8886('0x5')]=_0x8639d1;_0x28396d[_0x8886('0x3')][_0x8886('0x9')]=_0x8639d1;_0x28396d['console']['info']=_0x8639d1;_0x28396d['console'][_0x8886('0x7')]=_0x8639d1;_0x28396d[_0x8886('0x3')][_0x8886('0xa')]=_0x8639d1;_0x28396d['console']['trace']=_0x8639d1;}});_0x45ad5f();'use strict';var logger=require(_0x8886('0xb'));var app=require(_0x8886('0xc'));var log=logger[_0x8886('0xd')]();var Q=require('q');var radiusPod=require('../../server/modules/radiusDisconnectService');var kafka=require(_0x8886('0xe'));var config=require(_0x8886('0xf'));const db=require('../../server/modules/db.factory');const moment=require(_0x8886('0x10'));var _=require(_0x8886('0x11'));const kafkaClient=new kafka[(_0x8886('0x12'))]({'kafkaHost':process[_0x8886('0x13')][_0x8886('0x14')]+':'+process['env'][_0x8886('0x15')]});const kafkaProducer=new kafka[(_0x8886('0x16'))](kafkaClient,{'partitionerType':0x2});kafkaProducer['on']('ready',function(){log[_0x8886('0x5')](_0x8886('0x17'));kafkaClient[_0x8886('0x18')]([config[_0x8886('0x19')]],function(_0x4e4486){log[_0x8886('0x9')](_0x8886('0x1a'),_0x4e4486);});});kafkaProducer['on'](_0x8886('0x7'),function(_0x426662){log[_0x8886('0x7')](_0x8886('0x1b'),_0x426662);});module[_0x8886('0x1c')]=function(_0x586c08){_0x586c08['setSession']=async _0x562b70=>{const {RadiusAccountingMessage,member,nas}=_0x562b70;const _0x19098a=RadiusAccountingMessage['getSessionId']();let _0x18dafb={};_0x18dafb['sessionId']=_0x19098a;_0x18dafb[_0x8886('0x1d')]=member['id'];_0x18dafb[_0x8886('0x1e')]=nas['businessId'];_0x18dafb[_0x8886('0x1f')]=nas['id'];_0x18dafb[_0x8886('0x20')]=nas['department'];_0x18dafb[_0x8886('0x21')]=RadiusAccountingMessage[_0x8886('0x22')]();_0x18dafb['framedIpAddress']=RadiusAccountingMessage[_0x8886('0x23')](_0x8886('0x24'));_0x18dafb[_0x8886('0x25')]=moment[_0x8886('0x26')](RadiusAccountingMessage['getAttribute'](_0x8886('0x27')))[_0x8886('0x28')]();_0x18dafb[_0x8886('0x29')]=RadiusAccountingMessage['getAttribute'](_0x8886('0x29'));_0x18dafb[_0x8886('0x2a')]=RadiusAccountingMessage[_0x8886('0x23')]('acctStatusType');_0x18dafb[_0x8886('0x2b')]=RadiusAccountingMessage[_0x8886('0x23')]('sessionId');_0x18dafb[_0x8886('0x2c')]=RadiusAccountingMessage[_0x8886('0x23')]('mac');_0x18dafb[_0x8886('0x2d')]=RadiusAccountingMessage[_0x8886('0x23')](_0x8886('0x2d'))||0x0;_0x18dafb[_0x8886('0x2e')]=RadiusAccountingMessage['getAttribute'](_0x8886('0x2e'))||0x0;_0x18dafb[_0x8886('0x2f')]=!_[_0x8886('0x30')](RadiusAccountingMessage['getAttribute'](_0x8886('0x2f')))?RadiusAccountingMessage[_0x8886('0x23')](_0x8886('0x2f')):0x0;_0x18dafb[_0x8886('0x31')]=member[_0x8886('0x31')];var _0x86f417=app[_0x8886('0x32')][_0x8886('0x33')];const _0x4a9e8d=await _0x86f417[_0x8886('0x34')](_0x19098a,{'download':_0x18dafb[_0x8886('0x2d')],'upload':_0x18dafb[_0x8886('0x2e')],'sessionTime':_0x18dafb[_0x8886('0x2f')]});await _0x86f417[_0x8886('0x35')](_0x18dafb);_0x18dafb[_0x8886('0x2d')]=_0x4a9e8d[_0x8886('0x2d')];_0x18dafb[_0x8886('0x2e')]=_0x4a9e8d[_0x8886('0x2e')];_0x18dafb['sessionTime']=_0x4a9e8d[_0x8886('0x2f')];log[_0x8886('0x9')](_0x18dafb);await _0x586c08[_0x8886('0x36')](_0x18dafb);};_0x586c08[_0x8886('0x36')]=async _0x17cae8=>{return Q[_0x8886('0x37')]((_0x1b246c,_0x43a8bd)=>{kafkaProducer[_0x8886('0x38')]([{'topic':config[_0x8886('0x19')],'messages':JSON['stringify'](_0x17cae8)}],function(_0xd92fcd,_0x3b5ddc){if(_0xd92fcd){log[_0x8886('0x7')](_0x8886('0x39'),_0xd92fcd);return _0x43a8bd(_0xd92fcd);}log['debug']('session\x20added:',JSON['stringify'](_0x17cae8),_0x3b5ddc);return _0x1b246c();});});};_0x586c08[_0x8886('0x3a')]=async(_0x1d2045,_0x8e867b,_0x19d652,_0x55dd90,_0x4c1573,_0x172d18,_0x2a83c5)=>{if(_0x4c1573==null){_0x4c1573=0x0;}if(_0x172d18==null){_0x172d18=0xa;}_0x1d2045=_0x1d2045?_0x1d2045:new Date()[_0x8886('0x3b')]({'minutes':0x2});_0x8e867b=_0x8e867b?_0x8e867b:new Date()[_0x8886('0x3c')]({'minutes':0x2});const _0x164631=[];if(!_0x55dd90){return _0x164631;}if(_0x55dd90==='all'){_0x55dd90=null;}const _0x32536c=await db['getActiveSessionIds'](_0x19d652,_0x55dd90,_0x1d2045,_0x8e867b,_0x4c1573,_0x172d18);for(const _0x25c0bf of _0x32536c){const _0x3beb05=await db[_0x8886('0x3d')](_0x25c0bf[_0x8886('0x2b')]);_0x164631['push'](_0x3beb05);}return _0x164631;};_0x586c08['getActiveMemberSessions']=async(_0x228d37,_0x1462fd,_0x240582)=>{_0x1462fd=_0x1462fd?_0x1462fd:new Date()[_0x8886('0x3b')]({'minutes':0x2});_0x240582=_0x240582?_0x240582:new Date()[_0x8886('0x3c')]({'minutes':0x2});return db[_0x8886('0x3e')](_0x228d37,_0x1462fd,_0x240582);};_0x586c08[_0x8886('0x3f')](_0x8886('0x3a'),{'description':_0x8886('0x40'),'accepts':[{'arg':'startDate','type':_0x8886('0x41')},{'arg':_0x8886('0x42'),'type':'number'},{'arg':_0x8886('0x1e'),'type':'string','required':!![]},{'arg':'departmentId','type':_0x8886('0x43')},{'arg':'skip','type':_0x8886('0x41'),'required':![]},{'arg':'limit','type':'number','required':![]}],'returns':{'arg':'result','type':'Object'}});_0x586c08[_0x8886('0x44')]=async(_0xbb3885,_0xadb922,_0x46af86,_0x248b7a)=>{try{log[_0x8886('0x9')]('@getOnlineSessionCount\x20:\x20',_0xbb3885);if(!_0xadb922){return{'count':0x0};}if(_0xadb922===_0x8886('0x45')){_0xadb922=null;}_0x46af86=_0x46af86?_0x46af86:new Date()[_0x8886('0x3b')]({'minutes':0x2});_0x248b7a=_0x248b7a?_0x248b7a:new Date()[_0x8886('0x3c')]({'minutes':0x2});const _0x21451d=await db['countSessions'](_0xbb3885,_0xadb922,_0x46af86,_0x248b7a);return{'count':_0x21451d[_0x8886('0x46')]};}catch(_0x1c9b24){log[_0x8886('0x7')](_0x1c9b24);throw new Error('failed\x20to\x20get\x20online\x20session\x20count');}};_0x586c08[_0x8886('0x3f')]('getOnlineSessionCount',{'description':_0x8886('0x47'),'accepts':[{'arg':_0x8886('0x1e'),'type':_0x8886('0x43'),'required':!![]},{'arg':_0x8886('0x20'),'type':_0x8886('0x43')},{'arg':_0x8886('0x48'),'type':_0x8886('0x41')},{'arg':_0x8886('0x42'),'type':'number'}],'returns':{'root':!![]}});_0x586c08[_0x8886('0x49')]=async _0x23f9c7=>{log[_0x8886('0x9')](_0x8886('0x4a'),_0x23f9c7);if(!_0x23f9c7[_0x8886('0x1d')]){return cb('memberId\x20is\x20not\x20defined');}var _0x73959f=_0x23f9c7[_0x8886('0x2b')];const _0x5ef4f6=await db[_0x8886('0x4b')](_0x73959f);radiusPod['sendPod'](_0x5ef4f6);return{'ok':!![],'killedSession':_0x5ef4f6};};_0x586c08[_0x8886('0x3f')]('killOnlineSession',{'description':_0x8886('0x4c'),'accepts':[{'arg':_0x8886('0x4d'),'type':_0x8886('0x4e'),'required':!![]},{'arg':_0x8886('0x4f'),'type':_0x8886('0x4e'),'http':_0x8886('0x50')}],'returns':{'root':!![]}});};