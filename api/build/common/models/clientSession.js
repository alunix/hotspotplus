var _0x8f20=['S2lsbCBPbmxpbmUgU2Vzc2lvbg==','c2Vzc2lvbg==','b2JqZWN0','b3B0aW9ucw==','b3B0aW9uc0Zyb21SZXF1ZXN0','YXBwbHk=','cmV0dXJuIChmdW5jdGlvbigpIA==','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','Y29uc29sZQ==','d2Fybg==','ZGVidWc=','aW5mbw==','ZXJyb3I=','ZXhjZXB0aW9u','dHJhY2U=','Li4vLi4vc2VydmVyL21vZHVsZXMvbG9nZ2Vy','Li4vLi4vc2VydmVyL3NlcnZlcg==','Li4vLi4vc2VydmVyL21vZHVsZXMvcmFkaXVzRGlzY29ubmVjdFNlcnZpY2U=','a2Fma2Etbm9kZQ==','Li4vLi4vc2VydmVyL21vZHVsZXMvY29uZmln','Li4vLi4vc2VydmVyL21vZHVsZXMvZGIuZmFjdG9yeQ==','bW9tZW50','dW5kZXJzY29yZQ==','ZW52','S0FGS0FfUE9SVA==','cmVhZHk=','UHJvZHVjZXIgcmVhZHkuLi4=','U0VTU0lPTl9UT1BJQw==','UHJvZHVjZXIgcHJlcGFyYXRpb24gZmFpbGVkOg==','ZXhwb3J0cw==','c2V0U2Vzc2lvbg==','YnVzaW5lc3NJZA==','bmFzSWQ=','ZGVwYXJ0bWVudElk','ZGVwYXJ0bWVudA==','bmFzSXA=','Z2V0TmFzSXA=','Z2V0QXR0cmlidXRl','ZnJhbWVkSXBBZGRyZXNz','Y3JlYXRpb25EYXRl','dXRj','dXNlcm5hbWU=','YWNjdFN0YXR1c1R5cGU=','c2Vzc2lvbklk','bWFj','ZG93bmxvYWQ=','dXBsb2Fk','c2Vzc2lvblRpbWU=','aXNVbmRlZmluZWQ=','Z3JvdXBJZGVudGl0eUlk','bW9kZWxz','VXNhZ2U=','Y2FsY3VsYXRlVXNhZ2U=','Y2FjaGVVc2FnZQ==','c2VuZFRvQnJva2Vy','cHJvbWlzZQ==','c2VuZA==','c3RyaW5naWZ5','RmFpbGVkIHRvIGFkZCBzZXNzaW9uIHRvIGthZmthOiA=','c2Vzc2lvbiBhZGRlZDo=','Z2V0T25saW5lVXNlcnM=','cmVtb3Zl','YWRk','YWxs','Z2V0QWN0aXZlU2Vzc2lvbklkcw==','Z2V0U2Vzc2lvblVzYWdl','cHVzaA==','Z2V0QWN0aXZlTWVtYmVyU2Vzc2lvbnM=','R2V0IE9ubGluZSBVc2VycyBSZXBvcnQu','bnVtYmVy','ZW5kRGF0ZQ==','c3RyaW5n','c2tpcA==','cmVzdWx0','Z2V0T25saW5lU2Vzc2lvbkNvdW50','QGdldE9ubGluZVNlc3Npb25Db3VudCA6IA==','ZmFpbGVkIHRvIGdldCBvbmxpbmUgc2Vzc2lvbiBjb3VudA==','cmVtb3RlTWV0aG9k','R2V0IE9ubGluZSBTZXNzaW9ucyBDb3VudC4=','a2lsbE9ubGluZVNlc3Npb24=','bWVtYmVySWQ=','Z2V0U2Vzc2lvbnNCeUlk','c2VuZFBvZA=='];(function(_0x13598c,_0x1cb1c1){var _0x47ed72=function(_0x187b02){while(--_0x187b02){_0x13598c['push'](_0x13598c['shift']());}};var _0x42c4c5=function(){var _0x172161={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x1641f4,_0x3b2b4d,_0x1d6b33,_0x2f7a8){_0x2f7a8=_0x2f7a8||{};var _0x456a90=_0x3b2b4d+'='+_0x1d6b33;var _0x1a5f39=0x0;for(var _0x1a5f39=0x0,_0xaca307=_0x1641f4['length'];_0x1a5f39<_0xaca307;_0x1a5f39++){var _0x10ac0f=_0x1641f4[_0x1a5f39];_0x456a90+=';\x20'+_0x10ac0f;var _0x45fd82=_0x1641f4[_0x10ac0f];_0x1641f4['push'](_0x45fd82);_0xaca307=_0x1641f4['length'];if(_0x45fd82!==!![]){_0x456a90+='='+_0x45fd82;}}_0x2f7a8['cookie']=_0x456a90;},'removeCookie':function(){return'dev';},'getCookie':function(_0x2735e6,_0x512191){_0x2735e6=_0x2735e6||function(_0x8a06c2){return _0x8a06c2;};var _0x51c808=_0x2735e6(new RegExp('(?:^|;\x20)'+_0x512191['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x18efbb=function(_0x51f306,_0x26c2be){_0x51f306(++_0x26c2be);};_0x18efbb(_0x47ed72,_0x1cb1c1);return _0x51c808?decodeURIComponent(_0x51c808[0x1]):undefined;}};var _0x3bba13=function(){var _0x3aba02=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x3aba02['test'](_0x172161['removeCookie']['toString']());};_0x172161['updateCookie']=_0x3bba13;var _0x292dee='';var _0x24795d=_0x172161['updateCookie']();if(!_0x24795d){_0x172161['setCookie'](['*'],'counter',0x1);}else if(_0x24795d){_0x292dee=_0x172161['getCookie'](null,'counter');}else{_0x172161['removeCookie']();}};_0x42c4c5();}(_0x8f20,0x1a4));var _0x08f2=function(_0x4b055c,_0x4b870b){_0x4b055c=_0x4b055c-0x0;var _0x4b62bb=_0x8f20[_0x4b055c];if(_0x08f2['initialized']===undefined){(function(){var _0x468a51;try{var _0x54f40d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x468a51=_0x54f40d();}catch(_0x170f94){_0x468a51=window;}var _0x47a3bf='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x468a51['atob']||(_0x468a51['atob']=function(_0x278c5e){var _0x464fe7=String(_0x278c5e)['replace'](/=+$/,'');for(var _0x582ef9=0x0,_0x14b5d0,_0x2dbd25,_0x5b3b34=0x0,_0x574cf8='';_0x2dbd25=_0x464fe7['charAt'](_0x5b3b34++);~_0x2dbd25&&(_0x14b5d0=_0x582ef9%0x4?_0x14b5d0*0x40+_0x2dbd25:_0x2dbd25,_0x582ef9++%0x4)?_0x574cf8+=String['fromCharCode'](0xff&_0x14b5d0>>(-0x2*_0x582ef9&0x6)):0x0){_0x2dbd25=_0x47a3bf['indexOf'](_0x2dbd25);}return _0x574cf8;});}());_0x08f2['base64DecodeUnicode']=function(_0x532ffb){var _0x36e363=atob(_0x532ffb);var _0xf737d0=[];for(var _0x41dfc9=0x0,_0x37f07d=_0x36e363['length'];_0x41dfc9<_0x37f07d;_0x41dfc9++){_0xf737d0+='%'+('00'+_0x36e363['charCodeAt'](_0x41dfc9)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xf737d0);};_0x08f2['data']={};_0x08f2['initialized']=!![];}var _0xfa4181=_0x08f2['data'][_0x4b055c];if(_0xfa4181===undefined){var _0x3c36c5=function(_0x5b0c03){this['rc4Bytes']=_0x5b0c03;this['states']=[0x1,0x0,0x0];this['newState']=function(){return'newState';};this['firstState']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['secondState']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3c36c5['prototype']['checkState']=function(){var _0x51d12b=new RegExp(this['firstState']+this['secondState']);return this['runState'](_0x51d12b['test'](this['newState']['toString']())?--this['states'][0x1]:--this['states'][0x0]);};_0x3c36c5['prototype']['runState']=function(_0x5154d9){if(!Boolean(~_0x5154d9)){return _0x5154d9;}return this['getState'](this['rc4Bytes']);};_0x3c36c5['prototype']['getState']=function(_0x1e9b7b){for(var _0x5851d4=0x0,_0x46a25c=this['states']['length'];_0x5851d4<_0x46a25c;_0x5851d4++){this['states']['push'](Math['round'](Math['random']()));_0x46a25c=this['states']['length'];}return _0x1e9b7b(this['states'][0x0]);};new _0x3c36c5(_0x08f2)['checkState']();_0x4b62bb=_0x08f2['base64DecodeUnicode'](_0x4b62bb);_0x08f2['data'][_0x4b055c]=_0x4b62bb;}else{_0x4b62bb=_0xfa4181;}return _0x4b62bb;};var _0x56f135=function(){var _0x5ab2f2=!![];return function(_0x46d67d,_0x1b0288){var _0x3f7bf8=_0x5ab2f2?function(){if(_0x1b0288){var _0x4d59bf=_0x1b0288['apply'](_0x46d67d,arguments);_0x1b0288=null;return _0x4d59bf;}}:function(){};_0x5ab2f2=![];return _0x3f7bf8;};}();var _0x5cea6b=_0x56f135(this,function(){var _0x2006b6=function(){return'\x64\x65\x76';},_0x192113=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x5e5257=function(){var _0x56b07f=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x56b07f['\x74\x65\x73\x74'](_0x2006b6['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x40efb5=function(){var _0x18e735=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x18e735['\x74\x65\x73\x74'](_0x192113['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x2828ab=function(_0x1c6f75){var _0x5e7cf7=~-0x1>>0x1+0xff%0x0;if(_0x1c6f75['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x5e7cf7)){_0x15d9bb(_0x1c6f75);}};var _0x15d9bb=function(_0x8ce974){var _0x10db3f=~-0x4>>0x1+0xff%0x0;if(_0x8ce974['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x10db3f){_0x2828ab(_0x8ce974);}};if(!_0x5e5257()){if(!_0x40efb5()){_0x2828ab('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x2828ab('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x2828ab('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x5cea6b();var _0x8ad939=function(){var _0xfd50eb=!![];return function(_0x2c5efb,_0x462fd4){var _0x5b4c38=_0xfd50eb?function(){if(_0x462fd4){var _0x563092=_0x462fd4[_0x08f2('0x0')](_0x2c5efb,arguments);_0x462fd4=null;return _0x563092;}}:function(){};_0xfd50eb=![];return _0x5b4c38;};}();var _0x3779a5=_0x8ad939(this,function(){var _0xe8819=function(){};var _0x472f7f;try{var _0x120ed3=Function(_0x08f2('0x1')+_0x08f2('0x2')+');');_0x472f7f=_0x120ed3();}catch(_0x289987){_0x472f7f=window;}if(!_0x472f7f[_0x08f2('0x3')]){_0x472f7f[_0x08f2('0x3')]=function(_0x458b75){var _0x50a104={};_0x50a104['log']=_0x458b75;_0x50a104[_0x08f2('0x4')]=_0x458b75;_0x50a104[_0x08f2('0x5')]=_0x458b75;_0x50a104[_0x08f2('0x6')]=_0x458b75;_0x50a104[_0x08f2('0x7')]=_0x458b75;_0x50a104[_0x08f2('0x8')]=_0x458b75;_0x50a104[_0x08f2('0x9')]=_0x458b75;return _0x50a104;}(_0xe8819);}else{_0x472f7f[_0x08f2('0x3')]['log']=_0xe8819;_0x472f7f[_0x08f2('0x3')][_0x08f2('0x4')]=_0xe8819;_0x472f7f[_0x08f2('0x3')][_0x08f2('0x5')]=_0xe8819;_0x472f7f[_0x08f2('0x3')][_0x08f2('0x6')]=_0xe8819;_0x472f7f[_0x08f2('0x3')][_0x08f2('0x7')]=_0xe8819;_0x472f7f[_0x08f2('0x3')][_0x08f2('0x8')]=_0xe8819;_0x472f7f[_0x08f2('0x3')][_0x08f2('0x9')]=_0xe8819;}});_0x3779a5();'use strict';var logger=require(_0x08f2('0xa'));var app=require(_0x08f2('0xb'));var log=logger['createLogger']();var Q=require('q');var radiusPod=require(_0x08f2('0xc'));var kafka=require(_0x08f2('0xd'));var config=require(_0x08f2('0xe'));const db=require(_0x08f2('0xf'));const moment=require(_0x08f2('0x10'));var _=require(_0x08f2('0x11'));const kafkaClient=new kafka['KafkaClient']({'kafkaHost':process['env']['KAFKA_IP']+':'+process[_0x08f2('0x12')][_0x08f2('0x13')]});const kafkaProducer=new kafka['Producer'](kafkaClient,{'partitionerType':0x2});kafkaProducer['on'](_0x08f2('0x14'),function(){log[_0x08f2('0x4')](_0x08f2('0x15'));kafkaClient['refreshMetadata']([config[_0x08f2('0x16')]],function(_0x4628e0){log['debug']('@refreshMetadata\x20Error:',_0x4628e0);});});kafkaProducer['on'](_0x08f2('0x7'),function(_0x23ef1e){log[_0x08f2('0x7')](_0x08f2('0x17'),_0x23ef1e);});module[_0x08f2('0x18')]=function(_0x2ee4ce){_0x2ee4ce[_0x08f2('0x19')]=async _0x42f97a=>{const {RadiusAccountingMessage,member,nas}=_0x42f97a;const _0x473c7e=RadiusAccountingMessage['getSessionId']();let _0x4a7c99={};_0x4a7c99['sessionId']=_0x473c7e;_0x4a7c99['memberId']=member['id'];_0x4a7c99['businessId']=nas[_0x08f2('0x1a')];_0x4a7c99[_0x08f2('0x1b')]=nas['id'];_0x4a7c99[_0x08f2('0x1c')]=nas[_0x08f2('0x1d')];_0x4a7c99[_0x08f2('0x1e')]=RadiusAccountingMessage[_0x08f2('0x1f')]();_0x4a7c99['framedIpAddress']=RadiusAccountingMessage[_0x08f2('0x20')](_0x08f2('0x21'));_0x4a7c99[_0x08f2('0x22')]=moment[_0x08f2('0x23')](RadiusAccountingMessage[_0x08f2('0x20')]('timestamp'))['unix']();_0x4a7c99[_0x08f2('0x24')]=RadiusAccountingMessage[_0x08f2('0x20')](_0x08f2('0x24'));_0x4a7c99['accStatusType']=RadiusAccountingMessage['getAttribute'](_0x08f2('0x25'));_0x4a7c99[_0x08f2('0x26')]=RadiusAccountingMessage[_0x08f2('0x20')](_0x08f2('0x26'));_0x4a7c99['mac']=RadiusAccountingMessage[_0x08f2('0x20')](_0x08f2('0x27'));_0x4a7c99[_0x08f2('0x28')]=RadiusAccountingMessage[_0x08f2('0x20')](_0x08f2('0x28'))||0x0;_0x4a7c99[_0x08f2('0x29')]=RadiusAccountingMessage[_0x08f2('0x20')](_0x08f2('0x29'))||0x0;_0x4a7c99[_0x08f2('0x2a')]=!_[_0x08f2('0x2b')](RadiusAccountingMessage['getAttribute'](_0x08f2('0x2a')))?RadiusAccountingMessage[_0x08f2('0x20')](_0x08f2('0x2a')):0x0;_0x4a7c99[_0x08f2('0x2c')]=member[_0x08f2('0x2c')];var _0x1cd1bd=app[_0x08f2('0x2d')][_0x08f2('0x2e')];const _0x599a39=await _0x1cd1bd[_0x08f2('0x2f')](_0x473c7e,{'download':_0x4a7c99['download'],'upload':_0x4a7c99[_0x08f2('0x29')],'sessionTime':_0x4a7c99[_0x08f2('0x2a')]});await _0x1cd1bd[_0x08f2('0x30')](_0x4a7c99);_0x4a7c99[_0x08f2('0x28')]=_0x599a39[_0x08f2('0x28')];_0x4a7c99[_0x08f2('0x29')]=_0x599a39[_0x08f2('0x29')];_0x4a7c99['sessionTime']=_0x599a39[_0x08f2('0x2a')];log['debug'](_0x4a7c99);await _0x2ee4ce[_0x08f2('0x31')](_0x4a7c99);};_0x2ee4ce['sendToBroker']=async _0x31fbca=>{return Q[_0x08f2('0x32')]((_0x515d5c,_0x35b34b)=>{kafkaProducer[_0x08f2('0x33')]([{'topic':config[_0x08f2('0x16')],'messages':JSON[_0x08f2('0x34')](_0x31fbca)}],function(_0x104a22,_0xbff613){if(_0x104a22){log[_0x08f2('0x7')](_0x08f2('0x35'),_0x104a22);return _0x35b34b(_0x104a22);}log[_0x08f2('0x5')](_0x08f2('0x36'),JSON[_0x08f2('0x34')](_0x31fbca),_0xbff613);return _0x515d5c();});});};_0x2ee4ce[_0x08f2('0x37')]=async(_0x558292,_0x5f167a,_0x251fbb,_0x4762e6,_0x2b4550,_0x29090b,_0x298b43)=>{if(_0x2b4550==null){_0x2b4550=0x0;}if(_0x29090b==null){_0x29090b=0xa;}_0x558292=_0x558292?_0x558292:new Date()[_0x08f2('0x38')]({'minutes':0x2});_0x5f167a=_0x5f167a?_0x5f167a:new Date()[_0x08f2('0x39')]({'minutes':0x2});const _0x56a9cc=[];if(!_0x4762e6){return _0x56a9cc;}if(_0x4762e6===_0x08f2('0x3a')){_0x4762e6=null;}const _0x5c57b1=await db[_0x08f2('0x3b')](_0x251fbb,_0x4762e6,_0x558292,_0x5f167a,_0x2b4550,_0x29090b);for(const _0x8bdb5 of _0x5c57b1){const _0x3c112c=await db[_0x08f2('0x3c')](_0x8bdb5['sessionId']);_0x56a9cc[_0x08f2('0x3d')](_0x3c112c);}return _0x56a9cc;};_0x2ee4ce[_0x08f2('0x3e')]=async(_0x2d7150,_0x10a038,_0x224b5d)=>{_0x10a038=_0x10a038?_0x10a038:new Date()[_0x08f2('0x38')]({'minutes':0x2});_0x224b5d=_0x224b5d?_0x224b5d:new Date()[_0x08f2('0x39')]({'minutes':0x2});return db['getMemberSessions'](_0x2d7150,_0x10a038,_0x224b5d);};_0x2ee4ce['remoteMethod'](_0x08f2('0x37'),{'description':_0x08f2('0x3f'),'accepts':[{'arg':'startDate','type':_0x08f2('0x40')},{'arg':_0x08f2('0x41'),'type':_0x08f2('0x40')},{'arg':_0x08f2('0x1a'),'type':_0x08f2('0x42'),'required':!![]},{'arg':_0x08f2('0x1c'),'type':_0x08f2('0x42')},{'arg':_0x08f2('0x43'),'type':_0x08f2('0x40'),'required':![]},{'arg':'limit','type':'number','required':![]}],'returns':{'arg':_0x08f2('0x44'),'type':'Object'}});_0x2ee4ce[_0x08f2('0x45')]=async(_0x394f73,_0x317bce,_0x443872,_0x19e294)=>{try{log[_0x08f2('0x5')](_0x08f2('0x46'),_0x394f73);if(!_0x317bce){return{'count':0x0};}if(_0x317bce==='all'){_0x317bce=null;}_0x443872=_0x443872?_0x443872:new Date()[_0x08f2('0x38')]({'minutes':0x2});_0x19e294=_0x19e294?_0x19e294:new Date()[_0x08f2('0x39')]({'minutes':0x2});const _0x591e49=await db['countSessions'](_0x394f73,_0x317bce,_0x443872,_0x19e294);return{'count':_0x591e49['count']};}catch(_0x4a650f){log['error'](_0x4a650f);throw new Error(_0x08f2('0x47'));}};_0x2ee4ce[_0x08f2('0x48')]('getOnlineSessionCount',{'description':_0x08f2('0x49'),'accepts':[{'arg':_0x08f2('0x1a'),'type':_0x08f2('0x42'),'required':!![]},{'arg':_0x08f2('0x1c'),'type':'string'},{'arg':'startDate','type':_0x08f2('0x40')},{'arg':_0x08f2('0x41'),'type':'number'}],'returns':{'root':!![]}});_0x2ee4ce[_0x08f2('0x4a')]=async _0x3ff4d0=>{log['debug']('@killOnlineSession\x20:\x20',_0x3ff4d0);if(!_0x3ff4d0[_0x08f2('0x4b')]){return cb('memberId\x20is\x20not\x20defined');}var _0x3bd7e2=_0x3ff4d0[_0x08f2('0x26')];const _0x55f5d8=await db[_0x08f2('0x4c')](_0x3bd7e2);radiusPod[_0x08f2('0x4d')](_0x55f5d8);return{'ok':!![],'killedSession':_0x55f5d8};};_0x2ee4ce['remoteMethod'](_0x08f2('0x4a'),{'description':_0x08f2('0x4e'),'accepts':[{'arg':_0x08f2('0x4f'),'type':_0x08f2('0x50'),'required':!![]},{'arg':_0x08f2('0x51'),'type':_0x08f2('0x50'),'http':_0x08f2('0x52')}],'returns':{'root':!![]}});};